<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Mistik Full</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial,sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; padding:20px; }
.container { max-width:1200px; margin:0 auto; background:white; border-radius:15px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
h1 { text-align:center; color:#333; margin-bottom:10px; }
.subtitle { text-align:center; color:#666; font-size:14px; margin-bottom:20px; }
.grid-container { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px; }
.input-section, .output-section { background:#f8f9fa; padding:20px; border-radius:10px; border:2px solid #e9ecef; }
.section-title { color:#333; margin-bottom:15px; font-size:16px; font-weight:bold; }
.data-input textarea { width:100%; height:150px; padding:12px; border:2px solid #ddd; border-radius:8px; font-size:14px; resize:vertical; margin-bottom:10px; }
.formula-input { margin-bottom:15px; }
.formula-input input { width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; font-size:16px; }
.formula-input input:focus { border-color:#667eea; outline:none; }
.button-group { display:flex; gap:10px; margin-bottom:15px; }
button { flex:1; padding:12px; border:none; border-radius:8px; font-size:14px; font-weight:bold; cursor:pointer; transition:all 0.3s; }
.btn-calculate { background:#4CAF50;color:white; }
.btn-clear { background:#f44336;color:white; }
button:hover { opacity:0.9; transform:translateY(-2px); }
.info { background:#e3f2fd; padding:12px; border-radius:8px; margin-bottom:15px; text-align:center; }
.result-box { background:#2d2d2d; color:#f8f8f2; padding:15px; border-radius:5px; font-family:'Courier New',monospace; min-height:120px; white-space:pre-wrap; line-height:1.4; }
.tables-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-top:20px; }
.table-container { background:#f8f9fa; padding:15px; border-radius:8px; border:1px solid #ddd; }
.table-title { font-weight:bold; margin-bottom:8px; color:#333; text-align:center; }
.table-content { font-family:'Courier New',monospace; font-size:12px; line-height:1.4; }
.explanation { background:#fff3cd; padding:15px; border-radius:8px; margin-top:20px; border:1px solid #ffeaa7; }
.explanation h3 { color:#856404; margin-bottom:10px; }
.explanation ul { color:#856404; padding-left:20px; }
.explanation li { margin-bottom:5px; }
.input-info { text-align:center; color:#666; font-size:12px; margin-bottom:10px; }
.debug-info { background:#ffebee; padding:10px; border-radius:5px; margin-top:10px; font-size:12px; color:#c62828; display:none; }
</style>
</head>
<body>
<div class="container">
    <h1>ğŸ”® KALKULATOR MISTIK FULL</h1>
    <div class="subtitle">Hitung rumus mistik dengan tabel konversi lengkap & pola naik X</div>
    
    <div class="grid-container">
        <div class="input-section">
            <div class="section-title">ğŸ“¥ INPUT DATA</div>
            <div class="data-input">
                <textarea id="inputData" placeholder="Masukkan angka saja, satu angka per baris">7013
8741
5337
7463
9359
8250
0376
9202
4063
6874
0489
2843
3752
8644
2962
6937
0559
8445
2429
5879
9158
5364
2190
3358
1452</textarea>
                <div class="input-info" id="inputInfo">25 angka terdeteksi</div>
            </div>
            <div class="formula-input">
                <input type="text" id="inputFormula" placeholder="Masukkan rumus (contoh: A6ix+K8mb.(mb))" value="A6ix+K8mb.(mb)">
            </div>
            <div class="button-group">
                <button class="btn-calculate" onclick="calculateFormula()">ğŸ§® HITUNG</button>
                <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ CLEAR</button>
            </div>
            <div class="info" id="info">Masukkan data dan rumus, lalu klik HITUNG</div>
            <div class="debug-info" id="debugInfo"></div>
        </div>
        
        <div class="output-section">
            <div class="section-title">ğŸ“¤ HASIL PERHITUNGAN</div>
            <div class="result-box" id="resultOutput">// Hasil perhitungan akan muncul di sini</div>
        </div>
    </div>

    <div class="tables-grid">
        <div class="table-container"><div class="table-title">TABEL IX</div><div class="table-content">0Â«Â»5 1Â«Â»6<br>2Â«Â»7 3Â«Â»8<br>4Â«Â»9</div></div>
        <div class="table-container"><div class="table-title">TABEL TY</div><div class="table-content">0Â«Â»7 1Â«Â»4<br>2Â«Â»9 3Â«Â»6<br>5Â«Â»8</div></div>
        <div class="table-container"><div class="table-title">TABEL ML</div><div class="table-content">0Â«Â»1 2Â«Â»5<br>3Â«Â»8 4Â«Â»7<br>6Â«Â»9</div></div>
        <div class="table-container"><div class="table-title">TABEL MB</div><div class="table-content">0Â«Â»8 1Â«Â»7<br>2Â«Â»6 3Â«Â»9<br>4Â«Â»5</div></div>
        <div class="table-container"><div class="table-title">TABEL M0</div><div class="table-content">0Â«Â»6 1Â«Â»5<br>2Â«Â»7 3Â«Â»8<br>4Â«Â»9</div></div>
        <div class="table-container"><div class="table-title">TABEL M1</div><div class="table-content">0Â«Â»1 2Â«Â»9<br>3Â«Â»8 4Â«Â»7<br>5Â«Â»6</div></div>
        <div class="table-container"><div class="table-title">TABEL M3</div><div class="table-content">0Â«Â»3 1Â«Â»2<br>4Â«Â»9 5Â«Â»8<br>6Â«Â»7</div></div>
        <div class="table-container"><div class="table-title">TABEL M5</div><div class="table-content">0Â«Â»5 1Â«Â»4<br>2Â«Â»3 6Â«Â»9<br>7Â«Â»8</div></div>
        <div class="table-container"><div class="table-title">TABEL M7</div><div class="table-content">0Â«Â»7 1Â«Â»6<br>2Â«Â»5 3Â«Â»4<br>8Â«Â»9</div></div>
        <div class="table-container"><div class="table-title">TABEL M9</div><div class="table-content">0Â«Â»9 1Â«Â»8<br>2Â«Â»7 3Â«Â»6<br>4Â«Â»5</div></div>
    </div>

    <div class="explanation">
        <h3>ğŸ“ CARA PENGGUNAAN:</h3>
        <ul>
            <li><strong>A = AS</strong> (digit pertama), <strong>C = COP</strong> (digit kedua)</li>
            <li><strong>K = KEPALA</strong> (digit ketiga), <strong>E = EKOR</strong> (digit terakhir)</li>
            <li><strong>J = JUMLAH K+E</strong> (jumlahkan sampai 1 digit jika perlu)</li>
            <li><strong>A1</strong> = AS hari ini, <strong>A2</strong> = AS kemarin, dll.</li>
            <li><strong>mb, ml, m9</strong> = konversi menggunakan tabel mistik</li>
            <li><strong>.(ml)</strong> = konversi hasil akhir ke tabel ML</li>
            <li>Hasil AI akan menampilkan juga pola â€œnaik Xâ€ secara otomatis</li>
        </ul>
    </div>
</div>

<script>
// Tabel mistik lengkap
const mistikTables = {
    'IX': {'0':'5','1':'6','2':'7','3':'8','4':'9','5':'0','6':'1','7':'2','8':'3','9':'4'},
    'TY': {'0':'7','1':'4','2':'9','3':'6','4':'1','5':'8','6':'3','7':'0','8':'5','9':'2'},
    'ML': {'0':'1','1':'0','2':'5','3':'8','4':'7','5':'2','6':'9','7':'4','8':'3','9':'6'},
    'MB': {'0':'8','1':'7','2':'6','3':'9','4':'5','5':'4','6':'2','7':'1','8':'0','9':'3'},
    'M0': {'0':'6','1':'5','2':'7','3':'8','4':'9','5':'1','6':'0','7':'2','8':'3','9':'4'},
    'M1': {'0':'1','1':'0','2':'9','3':'8','4':'7','5':'6','6':'5','7':'4','8':'3','9':'2'},
    'M3': {'0':'3','1':'2','2':'1','3':'0','4':'9','5':'8','6':'7','7':'6','8':'5','9':'4'},
    'M5': {'0':'5','1':'4','2':'3','3':'2','4':'1','5':'0','6':'9','7':'8','8':'7','9':'6'},
    'M7': {'0':'7','1':'6','2':'5','3':'4','4':'3','5':'2','6':'1','7':'0','8':'9','9':'8'},
    'M9': {'0':'9','1':'8','2':'7','3':'6','4':'5','5':'4','6':'3','7':'2','8':'1','9':'0'}
};

let dataHistory = [];

function calculateFormula() {
    const inputData = document.getElementById('inputData').value.trim();
    const formula = document.getElementById('inputFormula').value.trim();
    const debugInfo = document.getElementById('debugInfo');

    if (!inputData || !formula) {
        showInfo('Masukkan data dan rumus terlebih dahulu!', 'error');
        return;
    }

    try {
        parseInputData(inputData);
        const results = calculateAIForAll(formula);

        // Hitung pola "naik X"
        const naikXResults = results.map(res => {
            if (!res.canCalculate) return { number: res.number, ai: res.ai, pattern: '' };
            const initialDigits = res.digitsBeforeSum;
            const aiDigits = res.ai.toString().split('').map(d=>parseInt(d));
            const pattern = aiDigits.map((d,i)=>d - parseInt(initialDigits[i]||0)).join(',');
            return { number: res.number, ai: res.ai, pattern };
        });

        displayResult(results, formula, naikXResults);
        showInfo('Perhitungan berhasil!', 'success');

        debugInfo.style.display = 'block';
        let debugHTML = `<strong>Debug Info:</strong><br>`;
        dataHistory.forEach((data,index)=>{
            debugHTML += `Hari ${index+1}: ${data.number} (A:${data.as}, C:${data.cop}, K:${data.kepala}, E:${data.ekor}, J:${data.jumlah})<br>`;
        });
        debugInfo.innerHTML = debugHTML;

    } catch (error) {
        showInfo(`Error: ${error.message}`, 'error');
        console.error('Calculation error:', error);
    }
}

function parseInputData(inputData){
    dataHistory = [];
    const lines = inputData.split('\n').filter(line=>line.trim());
    const reversed = [...lines].reverse();
    reversed.forEach(line=>{
        const number = line.trim();
        if(/^\d+$/.test(number)){
            const as = number[0];
            const cop = number[1];
            const kepala = number[2];
            const ekor = number[3];
            const jumlah = reduceToSingleDigit(parseInt(kepala)+parseInt(ekor));
            dataHistory.push({ number, as, cop, kepala, ekor, jumlah });
        }
    });
}

function calculateAIForAll(formula){
    const results = [];
    const maxDayNeeded = findMaxDayInFormula(formula);
    for(let i=0;i<dataHistory.length;i++){
        if(i+maxDayNeeded<=dataHistory.length){
            const aiObj = calculateSingleAI(formula,i);
            results.push({ number:dataHistory[i].number, ai:aiObj.finalResult, digitsBeforeSum:aiObj.digitsBeforeSum, canCalculate:true });
        }else{
            results.push({ number:dataHistory[i].number, ai:'', digitsBeforeSum:[], canCalculate:false });
        }
    }
    return results;
}

function findMaxDayInFormula(formula){
    let maxDay = 1;
    const comps = formula.split('+');
    comps.forEach(c=>{
        const m=c.match(/^([AKCEJ])(\d+)/);
        if(m){ const day=parseInt(m[2]); if(day>maxDay) maxDay=day; }
    });
    return maxDay;
}

function calculateSingleAI(formula,currentDayIndex){
    let working = formula;
    const finalConv = working.match(/\.î€(\w+)î€/);
    if(finalConv) working = working.replace(/\.î€(\w+)î€/,'');
    const comps = working.split('+');
    let total=0, digitsBeforeSum=[];
    comps.forEach(c=>{
        const val = processComponent(c.trim(), currentDayIndex);
        total+=val;
        digitsBeforeSum.push(val);
    });
    if(finalConv){
        const table = finalConv[1].toUpperCase();
        total = parseInt(convertMistik(total.toString(), table));
    }
    const finalResult = reduceToSingleDigit(total);
    return { finalResult, digitsBeforeSum };
}

function processComponent(comp,currentDayIndex){
    const match = comp.match(/^([AKCEJ])(\d+)(\w*)$/);
    if(!match) throw new Error(`Format komponen tidak valid: ${comp}`);
    const type=match[1], dayOffset=parseInt(match[2]), conversion=match[3];
    const targetDayIndex=currentDayIndex+(dayOffset-1);
    if(targetDayIndex>=dataHistory.length) throw new Error(`Data tidak tersedia untuk ${comp}`);
    const data = dataHistory[targetDayIndex];
    let value;
    switch(type){
        case 'A': value=parseInt(data.as); break;
        case 'K': value=parseInt(data.kepala); break;
        case 'C': value=parseInt(data.cop); break;
        case 'E': value=parseInt(data.ekor); break;
        case 'J': value=data.jumlah; break;
        default: throw new Error(`Tipe tidak dikenal: ${type}`);
    }
    if(conversion) value = parseInt(convertMistik(value.toString(), conversion.toUpperCase()));
    return value;
}

function convertMistik(number,table){
    if(!mistikTables[table]) throw new Error(`Tabel mistik tidak ditemukan: ${table}`);
    const digit = reduceToSingleDigit(parseInt(number)).toString();
    if(mistikTables[table][digit]===undefined) throw new Error(`Angka ${digit} tidak ada di tabel ${table}`);
    return mistikTables[table][digit];
}

function reduceToSingleDigit(num){
    let res=num;
    while(res>9) res=res.toString().split('').reduce((sum,d)=>sum+parseInt(d),0);
    return res;
}

function displayResult(results, formula, naikXResults){
    const output=document.getElementById('resultOutput');
    let text='';
    const revResults=[...results].reverse();
    const revNaikX=[...naikXResults].reverse();
    revResults.forEach((res,idx)=>{
        if(res.canCalculate){
            const pattern = revNaikX[idx].pattern ? ` | naik X: [${revNaikX[idx].pattern}]` : '';
            text+=`${res.number} = ${res.ai} ai${pattern}\n`;
        }else{text+=`${res.number} = \t\n`;}
    });
    text+='======\n'+formula;
    output.textContent=text;
}

function clearAll(){
    document.getElementById('inputData').value = '';
    document.getElementById('inputFormula').value = 'A6ix+K8mb.(mb)';
    document.getElementById('resultOutput').textContent = `// Hasil perhitungan akan muncul di sini
// Format:
// 7013 = 	
// 8741 = 	
// 5337 = 	
// ...
// ======
// A6ix+K8mb.(mb)`;
    document.getElementById('info').textContent = 'Masukkan data dan rumus, lalu klik HITUNG';
    document.getElementById('inputInfo').textContent = '0 angka terdeteksi';
    document.getElementById('debugInfo').style.display = 'none';
    dataHistory = [];
}

function showInfo(message, type) {
    const infoDiv = document.getElementById('info');
    infoDiv.textContent = message;
    infoDiv.style.background = type === 'error' ? '#ffebee' : 
                               type === 'success' ? '#e8f5e8' : '#e3f2fd';
    infoDiv.style.color = type === 'error' ? '#c62828' :
                          type === 'success' ? '#2e7d32' : '#1565c0';
}

// Update info input real-time
function updateInputInfo() {
    const input = document.getElementById('inputData').value.trim();
    const numbers = input.split('\n').filter(line => line.trim() && line.match(/^\d+$/));
    document.getElementById('inputInfo').textContent = `${numbers.length} angka terdeteksi`;
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('inputData').addEventListener('input', updateInputInfo);
    updateInputInfo(); // Initialize

    // Support Ctrl+Enter untuk calculate
    document.getElementById('inputFormula').addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            calculateFormula();
        }
    });
});
</script>
</body>
</html>
