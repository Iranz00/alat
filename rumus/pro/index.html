<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Mistik Pro - Full Auto</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial,sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; padding:20px; }
.container { max-width:1400px; margin:0 auto; background:white; border-radius:15px; padding:30px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
h1 { text-align:center; color:#333; margin-bottom:10px; }
.subtitle { text-align:center; color:#666; font-size:14px; margin-bottom:30px; }
.input-section, .output-section { background:#f8f9fa; padding:25px; border-radius:10px; border:2px solid #e9ecef; margin-bottom:25px; }
.section-title { color:#333; margin-bottom:20px; font-size:18px; font-weight:bold; }
textarea { width:100%; border:2px solid #ddd; border-radius:8px; padding:15px; font-family:monospace; font-size:14px; resize:vertical; }
textarea:focus { border-color:#667eea; outline:none; }
.button-group { display:flex; gap:15px; margin-bottom:20px; }
button { flex:1; padding:15px; border:none; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; transition:all 0.3s; }
.btn-calculate { background:#4CAF50;color:white; }
.btn-clear { background:#f44336;color:white; }
button:hover { opacity:0.9; transform:translateY(-2px); }
.info { background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:20px; text-align:center; }
.result-box { background:#2d2d2d; color:#f8f8f2; padding:20px; border-radius:8px; font-family:'Courier New',monospace; min-height:200px; white-space:pre-wrap; line-height:1.5; font-size:14px; overflow-x:auto; user-select:all; -webkit-user-select:all; -moz-user-select:all; -ms-user-select:all; }
.pattern-analysis { background:#e8f5e8; padding:20px; border-radius:8px; margin-bottom:20px; border:1px solid #c8e6c9; display:none; }
.pattern-analysis h4 { color:#2e7d32; margin-bottom:15px; }
</style>
</head>
<body>
<div class="container">
    <h1>üîÆ KALKULATOR MISTIK PRO</h1>
    <div class="subtitle">Hitung multiple rumus mistik dengan pattern detection otomatis</div>

    <div class="input-section">
        <div class="section-title">üì• INPUT DATA & RUMUS</div>
        <textarea id="inputData" placeholder="Format: 6874= 94 . 91 . 49 ai&#10;0489= 83 . 35 . 49 ai"></textarea>
        <div class="info" id="inputInfo">0 data terdeteksi</div>

        <textarea id="inputFormula" placeholder="Satu rumus per baris&#10;A6ix+K8mb.(mb)&#10;A9‚ÄìC10.(ty)"></textarea>

        <div class="button-group">
            <button class="btn-calculate" onclick="calculateAdvanced()">üßÆ ANALISIS & HITUNG</button>
            <button class="btn-clear" onclick="clearAll()">üóëÔ∏è CLEAR</button>
        </div>

        <div class="pattern-analysis" id="patternAnalysis">
            <h4>üîç ANALISIS PATTERN DITEMUKAN:</h4>
            <div id="patternResults"></div>
        </div>
    </div>

    <div class="output-section">
        <div class="section-title">üì§ HASIL PERHITUNGAN</div>
        <div class="result-box" id="resultOutput">// Hasil akan muncul di sini</div>
    </div>
</div>

<script>
// Fungsi siklik 0-9
function naikSiklik(digit, steps) {
    return (parseInt(digit) + steps) % 10;
}

// Data dan pattern global
let detectedPatterns = [];

// Hitung utama
function calculateAdvanced() {
    const inputData = document.getElementById('inputData').value.trim();
    const formulasInput = document.getElementById('inputFormula').value.trim();
    if (!inputData || !formulasInput) { showInfo('Masukkan data dan rumus!', 'error'); return; }

    const parsedData = parseAdvancedInputData(inputData);
    const formulas = parseMultipleFormulas(formulasInput);
    detectPatterns(parsedData, formulas);
    const results = calculateAllData(parsedData, formulas);
    displayAdvancedResult(results, formulas);
    showInfo('Perhitungan otomatis berhasil!', 'success');
}

function parseAdvancedInputData(input) {
    const lines = input.split('\n').filter(l => l.trim());
    document.getElementById('inputInfo').textContent = `${lines.length} data terdeteksi`;
    const parsed = lines.map(line => {
        const match = line.match(/^(\d+)=\s*(.*)$/);
        let number = '', results=[], label='ai';
        if (match) {
            number = match[1];
            const parts = match[2].trim().split(/\s+/);
            parts.forEach(p => { if(p.match(/^\d+$/)) results.push(p); else if(p.match(/^[a-z]+$/i)) label=p; });
        }
        const components = { as:number[0], cop:number[1], kepala:number[2], ekor:number[3], jumlah:reduceToSingleDigit(parseInt(number[2])+parseInt(number[3])) };
        return {number, results, label, components};
    });
    return parsed;
}

function parseMultipleFormulas(input) {
    return input.split('\n').map(f=>f.trim()).filter(f=>f);
}

// Deteksi pattern otomatis
function detectPatterns(parsedData, formulas) {
    detectedPatterns = [];
    formulas.forEach((formula,index)=>{
        const pattern={formula, naikSequence:[], digitLength:2};
        const valid = parsedData.filter(d=>d.results.length>index && d.results[index]);
        if(valid.length>0) {
            pattern.digitLength = valid[0].results[index].length;
            for(let i=0;i<pattern.digitLength;i++){
                const naikVals = [];
                for(let j=0;j<valid.length-1;j++){
                    const curr=parseInt(valid[j].results[index][i]);
                    const next=parseInt(valid[j+1].results[index][i]);
                    naikVals.push((next-curr+10)%10);
                }
                pattern.naikSequence.push(findConsistentValue(naikVals));
            }
        } else { pattern.naikSequence = Array(pattern.digitLength).fill(1); }
        detectedPatterns.push(pattern);
    });
    displayPatternAnalysis();
}

function findConsistentValue(arr){
    if(arr.length===0) return 1;
    const freq={}; let maxCount=0, val=arr[0];
    arr.forEach(v=>{ freq[v]=(freq[v]||0)+1; if(freq[v]>maxCount){ maxCount=freq[v]; val=v; maxCount=freq[v]; }});
    return val;
}

function calculateAllData(parsedData, formulas){
    return parsedData.map(d=>{
        while(d.results.length<formulas.length) d.results.push('');
        formulas.forEach((f,i)=>{
            if(!d.results[i]||d.results[i]===''){
                const base = calculateSingleFormula(d,f);
                let final='';
                for(let j=0;j<detectedPatterns[i].digitLength;j++){
                    const digit = base[j]?parseInt(base[j]):parseInt(base);
                    final+=naikSiklik(digit, detectedPatterns[i].naikSequence[j]||0);
                }
                d.results[i]=final;
            }
        });
        return d;
    });
}

// Kalkulasi rumus universal
function calculateSingleFormula(data, formula){
    const c=data.components;
    const map={A:parseInt(c.as),C:parseInt(c.cop),K:parseInt(c.kepala),E:parseInt(c.ekor),J:parseInt(c.jumlah)};
    const formulaDigits = formula.match(/[A-CEJK]/gi)||[];
    let sum=0;
    formulaDigits.forEach(f=>{ if(map[f.toUpperCase()]!==undefined) sum+=map[f.toUpperCase()]; });
    let result=[sum%10];
    if(formula.includes('ix')||formula.includes('ml')||formula.includes('mb')) result.push((sum*2)%10);
    return result.join('');
}

// Display pattern
function displayPatternAnalysis(){
    const html = detectedPatterns.map((p,i)=>
        `<div style="margin-bottom:10px;padding:10px;background:#f1f8e9;border-radius:5px;">
        <strong>Rumus ${i+1}:</strong> ${p.formula}<br>
        <strong>Pattern "naik X":</strong> [${p.naikSequence.join(', ')}]<br>
        <strong>Digit output:</strong> ${p.digitLength}
        </div>`).join('');
    const div=document.getElementById('patternResults'); div.innerHTML=html; document.getElementById('patternAnalysis').style.display='block';
}

// Display hasil akhir
function displayAdvancedResult(results, formulas){
    const output = document.getElementById('resultOutput');
    let text='';
    results.forEach(d=>{
        text+=`${d.number}= ${d.results.slice(0,formulas.length).join(' . ')} ${d.label}\n`;
    });
    text+='======\n';
    formulas.forEach(f=>{text+=f+'\n';});
    output.textContent=text;
}

// Clear semua
function clearAll(){
    document.getElementById('inputData').value='';
    document.getElementById('inputFormula').value='';
    document.getElementById('resultOutput').textContent='// Hasil akan muncul di sini';
    document.getElementById('inputInfo').textContent='0 data terdeteksi';
    document.getElementById('patternAnalysis').style.display='none';
    detectedPatterns=[];
}

// Utils
function reduceToSingleDigit(num){ let r=num; while(r>9){r=r.toString().split('').reduce((s,d)=>s+parseInt(d),0);} return r; }
function showInfo(msg,type){const div=document.querySelector('.info'); div.textContent=msg; div.style.background=type==='error'?'#ffebee':'#e8f5e8'; div.style.color=type==='error'?'#c62828':'#2e7d32';}

// Update jumlah data real-time
document.getElementById('inputData').addEventListener('input',()=>{ const lines=document.getElementById('inputData').value.split('\n').filter(l=>l.trim()); document.getElementById('inputInfo').textContent=`${lines.length} data terdeteksi`; });
</script>
</body>
</html>
