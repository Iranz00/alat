<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator AI Mistik</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
.container { max-width:800px; margin:auto; background:white; padding:20px; border-radius:10px; }
textarea { width:100%; height:150px; font-family:'Courier New', monospace; font-size:14px; margin-bottom:10px; }
input { width:100%; padding:10px; margin-bottom:10px; }
button { padding:10px 15px; margin-right:10px; cursor:pointer; }
.result { background:#222; color:#fff; padding:15px; border-radius:5px; font-family:'Courier New', monospace; white-space:pre-wrap; }
</style>
</head>
<body>
<div class="container">
<h2>ðŸ”® Kalkulator AI Mistik</h2>

<textarea id="dataInput" placeholder="Masukkan data (satu angka per baris)"></textarea>
<input type="text" id="formulaInput" placeholder="Masukkan rumus per baris, pisah koma" value="A6ix+K8mb.(mb),A9â€“C10.(ty),C8ix+E2ml.(ml)">
<input type="text" id="patternInput" placeholder="Pattern naik X per digit (contoh: 4,3,2)" value="4,3,2">

<button onclick="hitungAI()">Hitung AI</button>

<div class="result" id="output"></div>
</div>

<script>
// === Tabel mistik ===
const mistikTables = {
    IX: {'0':'5','1':'6','2':'7','3':'8','4':'9','5':'0','6':'1','7':'2','8':'3','9':'4'},
    TY: {'0':'7','1':'4','2':'9','3':'6','4':'1','5':'8','6':'3','7':'0','8':'5','9':'2'},
    ML: {'0':'1','1':'0','2':'5','3':'8','4':'7','5':'2','6':'9','7':'4','8':'3','9':'6'},
    MB: {'0':'8','1':'7','2':'6','3':'9','4':'5','5':'4','6':'2','7':'1','8':'0','9':'3'}
};

// Fungsi untuk menjadikan angka single digit
function toSingleDigit(num){
    while(num>9) num = num.toString().split('').reduce((a,b)=>a+parseInt(b),0);
    return num;
}

// Fungsi konversi mistik
function konversi(num, table){
    let digit = toSingleDigit(num).toString();
    if(!mistikTables[table] || mistikTables[table][digit]===undefined){
        throw new Error(`Konversi ${digit} tidak tersedia di tabel ${table}`);
    }
    return parseInt(mistikTables[table][digit]);
}

// Fungsi hitung satu rumus
function hitungRumus(rumus,dataHist){
    // Contoh rumus: A6ix+K8mb.(mb)
    let hasilAkhir = [];
    let components = rumus.split('+');
    let finalConvMatch = rumus.match(/\.\((\w+)\)/);
    let finalConv = finalConvMatch ? finalConvMatch[1].toUpperCase() : null;

    let total = 0;
    components.forEach(comp=>{
        // Extract tipe, hari, konversi
        let m = comp.match(/^([AKCEJ])(\d+)(\w*)/);
        if(!m) throw new Error(`Format komponen tidak valid: ${comp}`);
        let type = m[1], day = parseInt(m[2]), conv = m[3] ? m[3].toUpperCase() : null;

        let index = day-1;
        if(index >= dataHist.length) throw new Error(`Data tidak cukup untuk ${comp}`);
        let data = dataHist[index];
        let val;
        switch(type){
            case 'A': val=parseInt(data.A); break;
            case 'K': val=parseInt(data.K); break;
            case 'C': val=parseInt(data.C); break;
            case 'E': val=parseInt(data.E); break;
            case 'J': val=data.J; break;
        }
        if(conv) val = konversi(val, conv);
        hasilAkhir.push(val);
    });

    // Hitung total (sesuai operasi + atau -)
    // Operasi di formula sekarang dianggap hanya + untuk kesederhanaan
    let sum = hasilAkhir.reduce((a,b)=>a+b,0);
    if(finalConv) sum = konversi(sum, finalConv);

    return toSingleDigit(sum);
}

// Fungsi hitung AI final
function hitungAI(){
    const dataInput = document.getElementById('dataInput').value.trim().split('\n').filter(s=>s);
    const formulas = document.getElementById('formulaInput').value.trim().split(',').map(s=>s.trim());
    const pattern = document.getElementById('patternInput').value.trim().split(',').map(s=>parseInt(s));

    // Buat data history mundur
    let dataHist = dataInput.slice().reverse().map(num=>{
        num = num.padStart(4,'0');
        return {
            num:num,
            A:parseInt(num[0]),
            C:parseInt(num[1]),
            K:parseInt(num[2]),
            E:parseInt(num[3]),
            J:toSingleDigit(parseInt(num[2])+parseInt(num[3]))
        }
    });

    let output = '';
    for(let i=dataHist.length-1;i>=0;i--){
        let aiDigits = [];
        formulas.forEach(rumus=>{
            let val = hitungRumus(rumus,dataHist.slice(i));
            aiDigits.push(val);
        });
        // Terapkan pattern "naik X"
        let aiFinal = aiDigits.map((d,idx)=>toSingleDigit(d + (pattern[idx]||0)));
        output += `${dataHist[i].num} = ${aiFinal.join('.')} ai\n`;
    }

    document.getElementById('output').textContent = output;
}
</script>
</body>
</html>
