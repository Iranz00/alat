<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Mistik Pro - Optimized</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial,sans-serif; background: linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; padding:20px; }
.container { max-width:1400px; margin:0 auto; background:white; border-radius:15px; padding:30px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
h1 { text-align:center; color:#333; margin-bottom:10px; }
.subtitle { text-align:center; color:#666; font-size:14px; margin-bottom:30px; }

.input-section { background:#f8f9fa; padding:25px; border-radius:10px; border:2px solid #e9ecef; margin-bottom:25px; }
.section-title { color:#333; margin-bottom:20px; font-size:18px; font-weight:bold; }
.data-input { margin-bottom:20px; }
.data-input textarea { width:100%; height:400px; padding:15px; border:2px solid #ddd; border-radius:8px; font-size:14px; resize:vertical; font-family:monospace; line-height:1.5; }
.data-input textarea:focus { border-color:#667eea; outline:none; }
.button-group { display:flex; gap:15px; margin-bottom:20px; }
button { flex:1; padding:15px; border:none; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; transition:all 0.3s; }
.btn-calculate { background:#4CAF50;color:white; }
.btn-clear { background:#f44336;color:white; }
.btn-copy { background:#2196F3;color:white; }
button:hover { opacity:0.9; transform:translateY(-2px); }
.info { background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:20px; text-align:center; }
.input-info { text-align:center; color:#666; font-size:14px; margin-bottom:15px; }
.progress { margin:10px 0; height:20px; background:#e0e0e0; border-radius:10px; overflow:hidden; display:none; }
.progress-bar { height:100%; background:#4CAF50; transition:width 0.3s; }
.brute-force-info { background:#fff3cd; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #ffeaa7; display:none; }

.output-section { background:#f8f9fa; padding:25px; border-radius:10px; border:2px solid #e9ecef; margin-bottom:25px; }
.result-box { background:#2d2d2d; color:#f8f8f2; padding:20px; border-radius:8px; font-family:'Courier New',monospace; min-height:300px; white-space:pre-wrap; line-height:1.5; font-size:14px; overflow-x:auto; user-select:all; }

.pattern-analysis { background:#e8f5e8; padding:20px; border-radius:8px; margin-bottom:20px; border:1px solid #c8e6c9; display:none; }
.pattern-analysis h4 { color:#2e7d32; margin-bottom:15px; }
.pattern-item { margin-bottom:15px; padding:10px; background:#f1f8e9; border-radius:5px; }
.pattern-valid { border-left:4px solid #4CAF50; }
.pattern-invalid { border-left:4px solid #ff9800; background:#fff3e0; }

.explanation { background:#fff3cd; padding:20px; border-radius:8px; margin-top:25px; border:1px solid #ffeaa7; }
.explanation h3 { color:#856404; margin-bottom:15px; }
.explanation ul { color:#856404; padding-left:20px; }
.explanation li { margin-bottom:8px; }
</style>
</head>
<body>
<div class="container">
    <h1>üîÆ KALKULATOR MISTIK PRO</h1>
    <div class="subtitle">Brute Force Pattern Detection - Optimized</div>
    
    <div class="input-section">
        <div class="section-title">üì• INPUT DATA & RUMUS</div>
        
        <div class="data-input">
            <textarea id="inputData" placeholder="Masukkan data & rumus...">6874 = 94 . 91 . 49 ai
0489 = 83 . 35 . 49 ai
2843 = 72 . 57 . 27 ai
3752 = 49 . 24 . 94 ai
8644 = 16 . 24 . 72 ai
2962 = 72 . 35 . 27 ai
6937 = 50 . 79 . 05 ai
0559 = 49 . 35 . 49 ai
8445 = 49 . 79 . 94 ai
2429 = 49 . 91 . 27 ai
5879 = 05 . 35 . 38 ai
9158 = 61 . 24 . 49 ai
5364 = 50 . 80 . 49 ai
2190 = 38 . 57 . 50 ai
3358 = 05 . 02 . 05 ai
1452 = 
======
A6ix+K8mb.(mb)
A9‚ÄìC10.(ty)
C8ix+E2ml.(ml)</textarea>
            <div class="input-info" id="inputInfo">Data dan rumus terdeteksi</div>
        </div>
        
        <div class="progress" id="progressBar">
            <div class="progress-bar" id="progressFill" style="width:0%"></div>
        </div>
        
        <div class="brute-force-info" id="bruteForceInfo">
            <strong>üîç BRUTE FORCE IN PROGRESS:</strong> 
            <span id="currentPattern">Testing pattern...</span> | 
            <span id="patternsTested">0/100 patterns tested</span>
        </div>
        
        <div class="button-group">
            <button class="btn-calculate" onclick="calculateWithBruteForce()">üßÆ BRUTE FORCE PATTERN</button>
            <button class="btn-clear" onclick="clearAll()">üóëÔ∏è CLEAR</button>
            <button class="btn-copy" onclick="copyResults()">üìã COPY RESULTS</button>
        </div>
        
        <div class="info" id="info">Masukkan data dan rumus, lalu klik BRUTE FORCE PATTERN</div>
        <div class="pattern-analysis" id="patternAnalysis">
            <h4>üîç HASIL BRUTE FORCE PATTERN:</h4>
            <div id="patternResults"></div>
        </div>
    </div>

    <div class="output-section">
        <div class="section-title">üì§ HASIL PERHITUNGAN</div>
        <div class="result-box" id="resultOutput">// Hasil perhitungan akan muncul di sini</div>
    </div>

    <div class="explanation">
        <h3>üìù BRUTE FORCE PATTERN DETECTION:</h3>
        <ul>
            <li>100 Pattern Combinations: Test semua pattern dari [0,0] sampai [9,9]</li>
            <li>Auto-Stop: Berhenti otomatis ketika menemukan pattern 100% akurat</li>
            <li>Real-time Progress: Lihat progress testing secara live</li>
            <li>No Errors: Tidak ada error handling yang kompleks</li>
            <li>Simple & Reliable: Pendekatan langsung dan dapat diandalkan</li>
        </ul>
    </div>
</div>

<script>
// Mistik Tables
const mistikTables = {
    'IX': {'0':'5','1':'6','2':'7','3':'8','4':'9','5':'0','6':'1','7':'2','8':'3','9':'4'},
    'TY': {'0':'7','1':'4','2':'9','3':'6','4':'1','5':'8','6':'3','7':'0','8':'5','9':'2'},
    'ML': {'0':'1','1':'0','2':'5','3':'8','4':'7','5':'2','6':'9','7':'4','8':'3','9':'6'},
    'MB': {'0':'8','1':'7','2':'6','3':'9','4':'5','5':'4','6':'2','7':'1','8':'0','9':'3'},
    'M0': {'0':'6','1':'5','2':'7','3':'8','4':'9','5':'1','6':'0','7':'2','8':'3','9':'4'},
    'M1': {'0':'1','1':'0','2':'9','3':'8','4':'7','5':'6','6':'5','7':'4','8':'3','9':'2'},
    'M3': {'0':'3','1':'2','2':'1','3':'0','4':'9','5':'8','6':'7','7':'6','8':'5','9':'4'},
    'M5': {'0':'5','1':'4','2':'3','3':'2','4':'1','5':'0','6':'9','7':'8','8':'7','9':'6'},
    'M7': {'0':'7','1':'6','2':'5','3':'4','4':'3','5':'2','6':'1','7':'0','8':'9','9':'8'},
    'M9': {'0':'9','1':'8','2':'7','3':'6','4':'5','5':'4','6':'3','7':'2','8':'1','9':'0'}
};

let dataHistory = [];
let foundPatterns = [];

// Helper: naik siklik
function naikSiklik(digit, steps){ return (parseInt(digit)+steps)%10; }
function reduceToSingleDigit(num){ while(num>9){ num=num.toString().split('').reduce((s,d)=>s+parseInt(d),0);} return num; }
function convertMistik(number, table){ if(!mistikTables[table]) return number; const digit=reduceToSingleDigit(parseInt(number)).toString(); return mistikTables[table][digit]||number; }

// Parse input
function parseCompleteInput(inputData){
    const lines=inputData.split('\n').filter(l=>l.trim()),parsedData=[],formulas=[];let foundSep=false;
    for(let line of lines){
        if(line.trim()==='======'){foundSep=true;continue;}
        if(!foundSep){
            const match=line.match(/^(\d+)\s*=\s*(.*?)\s*$/);if(match){
                const number=match[1],resultsStr=match[2].trim();let results=[],label='ai';
                if(resultsStr!==''){const parts=resultsStr.split(/\s+/);let tempResults=[],tempLabel='';
                    for(let part of parts){if(part==='.')continue;if(part.match(/^[a-z]+$/i)){tempLabel=part;}else if(part.match(/^\d+$/)){tempResults.push(part);}}
                    results=tempResults;label=tempLabel||'ai';
                }
                parsedData.push({number,results,label,components:extractComponents(number),baseResults:[]});
            }
        }else{if(line.trim() && !line.includes('======')) formulas.push(line.trim());}
    }
    if(!foundSep || formulas.length===0) formulas=['A6ix+K8mb.(mb)','A9‚ÄìC10.(ty)','C8ix+E2ml.(ml)'];
    return {parsedData,formulas};
}
function extractComponents(number){const as=number[0],cop=number[1],kepala=number[2],ekor=number[3],jumlah=reduceToSingleDigit(parseInt(kepala)+parseInt(ekor)); return {as,cop,kepala,ekor,jumlah};}

// Base calculation
function calculateBaseResults(parsedData, formulas){
    const reversed=[...parsedData].reverse();
    for(let fi=0;fi<formulas.length;fi++){
        const formula=formulas[fi];
        for(let di=0;di<reversed.length;di++){
            const data=reversed[di];try{const base=calculateSingleAI(formula,di,reversed);
            if(!data.baseResults)data.baseResults=[];data.baseResults[fi]=base;}catch(e){if(!data.baseResults)data.baseResults=[];data.baseResults[fi]='';}
        }
    }
}
function calculateSingleAI(formula,index,dataHist){
    let work=formula; const finalConv=work.match(/\.ÓÄÅ(\w+)ÓÄÅ/); if(finalConv) work=work.replace(/\.ÓÄÅ(\w+)ÓÄÅ/,'');
    const components=work.split('+'); let total=0;
    for(let comp of components){total+=processComponent(comp.trim(),index,dataHist);}
    if(finalConv){const conv=finalConv[1].toUpperCase();total=parseInt(convertMistik(total.toString(),conv));}
    return reduceToSingleDigit(total);
}
function processComponent(comp,index,dataHist){const m=comp.match(/^([AKCEJ])(\d+)(\w*)$/);if(!m)return 0;
const type=m[1],dayOffset=parseInt(m[2]),conv=m[3],target=index+(dayOffset-1); if(target>=dataHist.length)return 0;
const data=dataHist[target]; let value; switch(type){case 'A':value=parseInt(data.components.as);break; case 'K':value=parseInt(data.components.kepala);break; case 'C':value=parseInt(data.components.cop);break; case 'E':value=parseInt(data.components.ekor);break; case 'J':value=data.components.jumlah;break; default:value=0;} if(conv){value=parseInt(convertMistik(value.toString(),conv.toUpperCase()));} return value;}

// Brute Force
function bruteForcePatternDetection(parsedData, formulas){
    const results={patterns:[],totalTested:0,perfectMatches:0};
    for(let fi=0;fi<formulas.length;fi++){
        const formula=formulas[fi];
        const patternResult=findBestPatternForFormula(parsedData,formula,fi);
        results.patterns.push(patternResult);
        results.totalTested+=patternResult.testedPatterns;
        if(patternResult.isPerfectMatch)results.perfectMatches++;
    }
    return results;
}
function findBestPatternForFormula(parsedData, formula, fi){
    const validData=parsedData.filter(d=>d.results.length>fi && d.results[fi]!=''); if(validData.length<4){return {formula,pattern:null,accuracy:0,isPerfectMatch:false,testedPatterns:0,reason:`Hanya ${validData.length} data dengan hasil (minimal 4 required)`};}
    const digitLen=validData[0].results[fi].length; let bestPattern=null,bestAcc=0,tested=0;
    for(let p1=0;p1<=9;p1++){for(let p2=0;p2<=9;p2++){tested++;const currPattern=[p1,p2];
        if(tested%10===0){const perc=30+(tested/100)*50;updateProgress(perc);document.getElementById('currentPattern').textContent=`Testing [${p1},${p2}]`; document.getElementById('patternsTested').textContent=`${tested}/100 patterns tested`;}
        let correct=0,total=0;
        for(let i=0;i<validData.length;i++){const data=validData[i]; const base=data.baseResults[fi]; if(base===''||base===undefined)continue; let pred=''; let cd=parseInt(base); for(let j=0;j<digitLen;j++){cd=naikSiklik(cd,currPattern[j]); pred+=cd.toString();} if(pred===data.results[fi])correct++; total++;}
        const acc=total>0?(correct/total)*100:0; if(acc>bestAcc){bestAcc=acc;bestPattern=currPattern;if(acc===100){return {formula,pattern:bestPattern,accuracy:bestAcc,isPerfectMatch:true,testedPatterns:tested,reason:`Pattern sempurna ditemukan setelah ${tested} tests`};}}}}
    return {formula,pattern:bestPattern,accuracy:bestAcc,isPerfectMatch:bestAcc===100,testedPatterns:tested,reason:bestPattern?`Best pattern: [${bestPattern.join(', ')}] (${bestAcc.toFixed(1)}% accuracy)`:'Tidak ada pattern yang cocok'};
}

// Fill missing data
function calculateMissingDataWithPatterns(parsedData, formulas, patterns){
    const results=[...parsedData];
    for(let data of results){
        while(data.results.length<formulas.length)data.results.push('');
        for(let i=0;i<formulas.length;i++){
            if(!data.results[i]||data.results[i]===''){
                const pattern=patterns[i]; if(pattern&&pattern.pattern&&pattern.accuracy>=80){data.results[i]=calculateWithSpecificPattern(data,formulas[i],pattern.pattern,i);}
            }
        }
    }
    return results;
}
function calculateWithSpecificPattern(data, formula, pattern, fi){
    const base=data.baseResults[fi]; if(!base && base!==0)return '';
    let final=''; let cd=parseInt(base);
    for(let i=0;i<pattern.length;i++){cd=naikSiklik(cd,pattern[i]); final+=cd.toString();}
    return final;
}

// Display
function displayBruteForceResults(results){
    const patternAnalysis=document.getElementById('patternAnalysis');
    const patternResults=document.getElementById('patternResults'); let html='';
    results.patterns.forEach((p,i)=>{
        const statusClass=p.isPerfectMatch?'pattern-valid':p.accuracy>=80?'pattern-valid':'pattern-invalid';
        const statusIcon=p.isPerfectMatch?'üéØ':p.accuracy>=80?'‚úÖ':''‚ö†Ô∏è';
        html += `<div class="pattern-item ${statusClass}">`;
        html += `<div><strong>${statusIcon} Rumus ${i+1}:</strong> ${p.formula}</div>`;
        html += `<div><strong>Pattern:</strong> ${p.pattern ? '[' + p.pattern.join(', ') + ']' : 'Tidak ditemukan'}</div>`;
        html += `<div><strong>Accuracy:</strong> ${p.accuracy.toFixed(1)}%</div>`;
        html += `<div><strong>Status:</strong> ${p.reason}</div>`;
        html += `<div><strong>Patterns Tested:</strong> ${p.testedPatterns}</div>`;
        html += `</div>`;
    });

    html += `<div class="pattern-item pattern-valid">`;
    html += `<div><strong>üìä SUMMARY:</strong></div>`;
    html += `<div><strong>Total Patterns Tested:</strong> ${results.totalTested}</div>`;
    html += `<div><strong>Perfect Matches:</strong> ${results.perfectMatches}/${results.patterns.length}</div>`;
    html += `</div>`;

    patternResults.innerHTML = html;
    patternAnalysis.style.display = 'block';
}

function displayAdvancedResult(results, formulas){
    const output = document.getElementById('resultOutput');
    let outputText = '';
    results.forEach(result => {
        outputText += `${result.number} = `;
        if(result.results.length>0){
            const validResults = result.results.slice(0, formulas.length).filter(r=>r!=='');
            outputText += validResults.join(' . ');
            if(result.label && validResults.length>0){
                outputText += ` ${result.label}`;
            }
        }
        outputText += '\n';
    });
    outputText += '======\n';
    formulas.forEach(f=>{outputText += `${f}\n`;});
    output.textContent = outputText;
}

function updateProgress(percent){
    document.getElementById('progressFill').style.width = percent+'%';
}

function showInfo(message,type){
    const infoDiv = document.getElementById('info');
    infoDiv.textContent = message;
    infoDiv.style.background = type==='error'?'#ffebee':type==='success'?'#e8f5e8':'#e3f2fd';
    infoDiv.style.color = type==='error'?'#c62828':type==='success'?'#2e7d32':'#1565c0';
}

function clearAll(){
    document.getElementById('inputData').value=`6874 = 94 . 91 . 49 ai
0489 = 83 . 35 . 49 ai
2843 = 72 . 57 . 27 ai
3752 = 49 . 24 . 94 ai
8644 = 16 . 24 . 72 ai
2962 = 72 . 35 . 27 ai
6937 = 50 . 79 . 05 ai
0559 = 49 . 35 . 49 ai
8445 = 49 . 79 . 94 ai
2429 = 49 . 91 . 27 ai
5879 = 05 . 35 . 38 ai
9158 = 61 . 24 . 49 ai
5364 = 50 . 80 . 49 ai
2190 = 38 . 57 . 50 ai
3358 = 05 . 02 . 05 ai
1452 = 
======
A6ix+K8mb.(mb)
A9‚ÄìC10.(ty)
C8ix+E2ml.(ml)`;
    document.getElementById('resultOutput').textContent = `// Hasil perhitungan akan muncul di sini`;
    document.getElementById('info').textContent='Masukkan data dan rumus, lalu klik BRUTE FORCE PATTERN';
    document.getElementById('inputInfo').textContent='Data dan rumus terdeteksi';
    document.getElementById('patternAnalysis').style.display='none';
    document.getElementById('progressBar').style.display='none';
    document.getElementById('bruteForceInfo').style.display='none';
    dataHistory=[]; foundPatterns=[];
}

function copyResults(){
    const output = document.getElementById('resultOutput');
    navigator.clipboard.writeText(output.textContent).then(()=>{showInfo('Hasil berhasil disalin ke clipboard','success');},()=>{showInfo('Gagal menyalin hasil','error');});
}

// Main brute force trigger
function calculateWithBruteForce(){
    const inputData = document.getElementById('inputData').value.trim();
    if(!inputData){showInfo('Masukkan data dan rumus terlebih dahulu!','error'); return;}
    try{
        showInfo('Memulai Brute Force Pattern Detection...','info');
        document.getElementById('progressBar').style.display='block';
        document.getElementById('bruteForceInfo').style.display='block';
        updateProgress(0);

        const {parsedData, formulas} = parseCompleteInput(inputData);
        if(!parsedData || parsedData.length===0) throw new Error('Tidak ada data yang berhasil di-parse');

        calculateBaseResults(parsedData, formulas);
        updateProgress(30);

        const bruteResults = bruteForcePatternDetection(parsedData, formulas);
        foundPatterns = bruteResults.patterns;
        updateProgress(80);

        const finalResults = calculateMissingDataWithPatterns(parsedData, formulas, foundPatterns);
        updateProgress(90);

        displayAdvancedResult(finalResults, formulas);
        displayBruteForceResults(bruteResults);
        showInfo('Brute Force Pattern Detection selesai!','success');
        updateProgress(100);
    }catch(err){showInfo(`Error: ${err.message}`,'error'); console.error(err);}
}

// Input info update
function updateInputInfo(){
    const input=document.getElementById('inputData').value.trim();
    const lines=input.split('\n').filter(l=>l.trim());
    const dataCount=lines.filter(l=>l.match(/^\d+\s*=/)).length;
    const hasFormulas=input.includes('======');
    let info = `${dataCount} data terdeteksi`;
    if(hasFormulas) info+=' + rumus';
    document.getElementById('inputInfo').textContent=info;
}
document.addEventListener('DOMContentLoaded',()=>{document.getElementById('inputData').addEventListener('input',updateInputInfo);updateInputInfo();});
document.getElementById('inputData').addEventListener('keydown',function(e){if(e.ctrlKey && e.key==='Enter'){calculateWithBruteForce();}});
</script>
</body>
</html>
