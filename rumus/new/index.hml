<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Prediksi Mod+ - Brute Force Akurat</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); 
    min-height:100vh; 
    padding:20px;
    display: flex;
    align-items: flex-start;
    justify-content: center;
}
.container { 
    max-width:1000px; 
    width:100%;
    margin:0 auto; 
    background:white; 
    border-radius:20px; 
    padding:30px; 
    box-shadow:0 20px 40px rgba(0,0,0,0.15);
}
.header { 
    text-align:center; 
    margin-bottom:25px; 
}
h1 { 
    color:#2d3748; 
    margin-bottom:8px; 
    font-size:2.2rem;
    font-weight:700;
}
.subtitle { 
    text-align:center; 
    color:#718096; 
    font-size:15px; 
    margin-bottom:25px;
    line-height:1.5;
}
.grid-container { 
    display:grid; 
    grid-template-columns:1fr; 
    gap:25px; 
    margin-bottom:25px;
}
.input-section, .output-section { 
    background:#f8f9fa; 
    padding:25px; 
    border-radius:15px; 
    border:2px solid #e9ecef;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}
.section-title { 
    color:#2d3748; 
    margin-bottom:20px; 
    font-size:18px; 
    font-weight:bold;
    display: flex;
    align-items: center;
    gap: 10px;
}
.data-input textarea { 
    width:100%; 
    height:180px; 
    padding:15px; 
    border:2px solid #e2e8f0; 
    border-radius:12px; 
    font-size:15px; 
    resize:vertical; 
    margin-bottom:15px;
    font-family: 'Courier New', monospace;
    background: white;
    transition: all 0.3s;
}
.data-input textarea:focus { 
    border-color:#4361ee; 
    outline:none;
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
}
.data-input textarea::placeholder {
    color: #a0aec0;
}
.controls { 
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
}
.control-group {
    display: flex;
    flex-direction: column;
}
.control-group label {
    font-size: 14px;
    color: #4a5568;
    margin-bottom: 6px;
    font-weight: 500;
}
.control-group input {
    padding: 10px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 15px;
    transition: border 0.3s;
}
.control-group input:focus {
    border-color: #4361ee;
    outline: none;
    box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
}
.control-group input.invalid {
    border-color: #f44336;
    background-color: #fff5f5;
}
.button-group { 
    display:flex; 
    gap:12px; 
    margin-bottom:20px;
    flex-wrap: wrap;
}
button { 
    padding:14px 20px; 
    border:none; 
    border-radius:12px; 
    font-size:15px; 
    font-weight:600; 
    cursor:pointer; 
    transition:all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 120px;
}
.btn-run { 
    background:linear-gradient(135deg, #4CAF50, #45a049);
    color:white;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    flex: 1;
}
.btn-stop {
    background:linear-gradient(135deg, #FF9800, #F57C00);
    color:white;
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
    flex: 1;
}
.btn-clear { 
    background:linear-gradient(135deg, #ff6b6b, #ee5a52);
    color:white;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}
.btn-sample {
    background:linear-gradient(135deg, #2196F3, #1976D2);
    color:white;
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
}
button:hover:not(:disabled) { 
    transform:translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}
button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}
.info { 
    background:#e3f2fd; 
    padding:18px; 
    border-radius:12px; 
    margin-bottom:20px; 
    text-align:left;
    font-weight:500;
    border-left:4px solid #2196F3;
    font-size: 14px;
}
.info.success { background:#e8f5e8; border-left-color:#4CAF50; color:#2e7d32; }
.info.error { background:#ffebee; border-left-color:#f44336; color:#c62828; }
.info.progress { background:#fff8e1; border-left-color:#FF9800; color:#E65100; }
.info.warning { background:#fff8e1; border-left-color:#FF9800; color:#E65100; }
.stats {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}
.stat-box {
    background: #edf2f7;
    padding: 12px 15px;
    border-radius: 8px;
    flex: 1;
    min-width: 120px;
}
.stat-label {
    font-size: 12px;
    color: #718096;
    margin-bottom: 4px;
}
.stat-value {
    font-size: 20px;
    font-weight: bold;
    color: #2d3748;
}
.progress-bar {
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    margin: 15px 0;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    border-radius: 4px;
    width: 0%;
    transition: width 0.5s ease;
}
.result-box { 
    background:#1a202c; 
    color:#e2e8f0; 
    padding:20px; 
    border-radius:12px; 
    font-family:'Courier New',monospace; 
    white-space:pre-wrap; 
    line-height:1.6;
    border:1px solid #2d3748;
    font-size:14px;
    overflow-y: auto;
    max-height: 500px;
    min-height: 200px;
}
.result-box .prediction {
    color: #81C784;
    font-weight: bold;
}
.result-box .formula {
    color: #64B5F6;
}
.result-box .accuracy {
    color: #FFD54F;
}
.copy-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    transform: translateX(150%);
    transition: transform 0.3s ease;
}
.copy-notification.show {
    transform: translateX(0);
}
@media (max-width: 768px) {
    .container { padding: 15px; }
    .controls { grid-template-columns: 1fr; }
    .button-group { flex-direction: column; }
    button { width: 100%; }
    .stats { flex-direction: column; }
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ü§ñ Auto Prediksi Mod+</h1>
        <div class="subtitle">Brute-force tanpa input AI ‚Äî temukan rumus paling akurat</div>
    </div>
    <div class="grid-container">
        <div class="input-section">
            <div class="section-title">üì• INPUT DATA</div>
            <div class="data-input">
                <textarea id="numbers" placeholder="Masukkan angka 4D (satu per baris):
6834
6176
2243
1563
6271
2518"></textarea>
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Data Input</div>
                        <div class="stat-value" id="dataCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Rumus Dihasilkan</div>
                        <div class="stat-value" id="formulaCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Akurasi Terbaik</div>
                        <div class="stat-value" id="bestAccuracy">0%</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>Jumlah digit prediksi (1‚Äì4)</label>
                    <input type="number" id="digitCount" min="1" max="4" value="2">
                </div>
                <div class="control-group">
                    <label>Mod offset (1‚Äì9, default: 1 = mod+1)</label>
                    <input type="number" id="modOffset" min="1" max="9" value="1">
                </div>
            </div>
            <div class="button-group">
                <button class="btn-run" onclick="startSearch()" id="runBtn">üîç CARI RUMUS & PREDIKSI</button>
                <button class="btn-stop" onclick="stopSearch()" id="stopBtn" disabled>‚è∏Ô∏è STOP</button>
                <button class="btn-sample" onclick="loadSampleData()">üìã DATA CONTOH</button>
                <button class="btn-clear" onclick="clearAll()">üóëÔ∏è HAPUS</button>
            </div>
            <div class="info" id="info">
                <strong>Instruksi Penggunaan:</strong>
                <ol style="margin-top:8px; padding-left:20px; font-size:14px;">
                    <li>Masukkan minimal 3 angka 4D (semakin banyak semakin akurat)</li>
                    <li>Atur jumlah digit prediksi (default: 2 digit)</li>
                    <li>Atur mod offset untuk pola prediksi</li>
                    <li>Klik "CARI RUMUS & PREDIKSI" untuk memulai analisis</li>
                    <li>Gunakan "STOP" jika proses terlalu lama</li>
                </ol>
                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    <strong>Note:</strong> Sistem akan menghasilkan ribuan kombinasi rumus dan mencari yang paling akurat.
                </div>
            </div>
        </div>
        <div class="output-section">
            <div class="section-title">üì§ HASIL PREDIKSI</div>
            <div class="result-box" id="resultOutput">// Hasil akan muncul di sini setelah klik "CARI RUMUS & PREDIKSI"

// Format output:
// - Prediksi untuk setiap data
// - Rumus terbaik dengan akurasi
// - Prediksi untuk periode berikutnya</div>
            <div class="button-group">
                <button class="btn-run" onclick="copyOutput()">üìã SALIN OUTPUT</button>
                <button class="btn-sample" onclick="saveResults()">üíæ SIMPAN HASIL</button>
            </div>
        </div>
    </div>
</div>
<div class="copy-notification" id="copyNotification">
    ‚úÖ Output berhasil disalin!
</div>

<script>
// Tabel mistik
const mistikTables = {
    'IX': {'0':'5','1':'6','2':'7','3':'8','4':'9','5':'0','6':'1','7':'2','8':'3','9':'4'},
    'ML': {'0':'1','1':'0','2':'5','3':'8','4':'7','5':'2','6':'9','7':'4','8':'3','9':'6'},
    'MB': {'0':'8','1':'7','2':'6','3':'9','4':'5','5':'4','6':'2','7':'1','8':'0','9':'3'},
    'TY': {'0':'7','1':'4','2':'9','3':'6','4':'1','5':'8','6':'3','7':'0','8':'5','9':'2'},
    'M9': {'0':'9','1':'8','2':'7','3':'6','4':'5','5':'4','6':'3','7':'2','8':'1','9':'0'}
};

let dataHistory = [];
let bestResults = [];
let isSearching = false;
let searchTimeout = null;

// Update data count
function updateDataCount() {
    const input = document.getElementById('numbers').value.trim();
    const lines = input.split('\n').map(l => l.trim()).filter(l => /^\d{4}$/.test(l));
    document.getElementById('dataCount').textContent = lines.length;
}

// Load sample data
function loadSampleData() {
    const sampleData = `6834
6176
2243
1563
6271
2518
4892
7361
9054
1427`;
    
    document.getElementById('numbers').value = sampleData;
    updateDataCount();
    showInfo('Data contoh berhasil dimuat!', 'success');
}

// Utility functions
function reduceToSingleDigit(num) {
    let n = Math.abs(num);
    while (n > 9) {
        n = n.toString().split('').reduce((sum, d) => sum + parseInt(d), 0);
    }
    return n;
}

function convertMistik(number, table) {
    const digit = reduceToSingleDigit(parseInt(number)).toString();
    if (mistikTables[table] && mistikTables[table][digit] !== undefined) {
        return mistikTables[table][digit];
    }
    return digit;
}

function validateInputs() {
    const digitCount = parseInt(document.getElementById('digitCount').value);
    const modOffset = parseInt(document.getElementById('modOffset').value);
    let isValid = true;
    
    if (digitCount < 1 || digitCount > 4 || isNaN(digitCount)) {
        document.getElementById('digitCount').classList.add('invalid');
        isValid = false;
    } else {
        document.getElementById('digitCount').classList.remove('invalid');
    }
    
    if (modOffset < 1 || modOffset > 9 || isNaN(modOffset)) {
        document.getElementById('modOffset').classList.add('invalid');
        isValid = false;
    } else {
        document.getElementById('modOffset').classList.remove('invalid');
    }
    
    return isValid;
}

// Process component with error handling
function processComponent(component, currentDayIndex, dataHistory) {
    try {
        const match = component.match(/^(A|C|K|E|J|Js|J3D|J4D)(\d+)(\w*)$/);
        if (!match) throw new Error(`Komponen tidak valid: ${component}`);
        
        const [_, type, dayStr, mistik] = match;
        const dayOffset = parseInt(dayStr);
        if (dayOffset > 10) throw new Error(`Offset >10 tidak diizinkan`);
        
        const targetDay = currentDayIndex - (dayOffset - 1);
        if (targetDay < 0) throw new Error(`Data tidak cukup untuk ${component}`);
        
        const d = dataHistory[targetDay];
        let val;
        switch(type) {
            case 'A': val = parseInt(d[0]); break;
            case 'C': val = parseInt(d[1]); break;
            case 'K': val = parseInt(d[2]); break;
            case 'E': val = parseInt(d[3]); break;
            case 'J':  val = reduceToSingleDigit(parseInt(d[2]) + parseInt(d[3])); break;
            case 'Js': val = reduceToSingleDigit(Math.abs(parseInt(d[2]) - parseInt(d[3]))); break;
            case 'J3D':val = reduceToSingleDigit(parseInt(d[1])+parseInt(d[2])+parseInt(d[3])); break;
            case 'J4D':val = reduceToSingleDigit(parseInt(d[0])+parseInt(d[1])+parseInt(d[2])+parseInt(d[3])); break;
            default: throw new Error(`Komponen tidak dikenal: ${type}`);
        }
        
        if (mistik) {
            const m = mistik.toUpperCase();
            if (['IX','ML','MB','TY','M9'].includes(m)) {
                val = parseInt(convertMistik(val, m));
            }
        }
        return val;
    } catch (e) {
        throw e;
    }
}

function calculateAI(formula, idx, data) {
    try {
        const finalMatch = formula.match(/\.\((\w+)\)/);
        let working = formula;
        if (finalMatch) working = working.replace(/\.\((\w+)\)/, '');
        
        const parts = working.split(/([+\-])/).filter(x => x.trim());
        let total = 0;
        let op = '+';
        
        for (let p of parts) {
            if (p === '+' || p === '-') { 
                op = p; 
                continue; 
            }
            const val = processComponent(p.trim(), idx, data);
            total = op === '+' ? total + val : total - val;
        }
        
        if (finalMatch) {
            const f = finalMatch[1].toUpperCase();
            if (['IX','ML','MB','TY','M9'].includes(f)) {
                total = parseInt(convertMistik(total, f));
            }
        }
        
        return reduceToSingleDigit(total);
    } catch (e) {
        throw new Error(`Gagal menghitung AI: ${e.message}`);
    }
}

function generatePrediction(ai, digitCount, modOffset) {
    const digits = [];
    for (let i = 0; i < digitCount; i++) {
        digits.push((ai + i * modOffset) % 10);
    }
    return digits.join('');
}

function testFormula(formula, digitCount, modOffset, data) {
    let hits = 0;
    let attempts = 0;
    const predictions = [];
    
    for (let i = 0; i < data.length - 1; i++) {
        try {
            const ai = calculateAI(formula, i, data);
            const pred = generatePrediction(ai, digitCount, modOffset);
            const next = data[i + 1];
            
            let hit = false;
            for (let d of pred) {
                if (next.includes(d)) {
                    hit = true;
                    break;
                }
            }
            
            predictions.push({ 
                number: data[i], 
                ai: ai, 
                pred: pred, 
                hit: hit,
                actual: next 
            });
            attempts++;
            if (hit) hits++;
        } catch (e) {
            // Skip invalid formulas
            continue;
        }
    }
    
    return { 
        hits, 
        attempts, 
        predictions, 
        accuracy: attempts ? hits / attempts : 0 
    };
}

function generateOptimizedFormulas() {
    const comps = ['A','C','K','E','J','Js','J3D','J4D'];
    const offsets = [1,2,3]; // Reduced for optimization
    const mistiks = ['', 'ix','ml','mb','ty','m9'];
    const finals = ['', '.(ix)', '.(ml)', '.(mb)', '.(ty)', '.(m9)'];
    const ops = ['+', '-'];
    
    const formulas = new Set();
    
    // Generate simpler formulas first
    for (let c of comps) {
        for (let o of offsets) {
            for (let m of mistiks) {
                for (let f of finals) {
                    formulas.add(`${c}${o}${m}${f}`);
                }
            }
        }
    }
    
    // Add some 2-component formulas
    for (let c1 of comps.slice(0, 4)) {
        for (let o1 of offsets) {
            for (let m1 of ['', 'ix']) {
                for (let op of ops) {
                    for (let c2 of comps.slice(0, 4)) {
                        for (let o2 of offsets) {
                            for (let m2 of ['', 'ix']) {
                                for (let f of finals.slice(0, 3)) {
                                    formulas.add(`${c1}${o1}${m1}${op}${c2}${o2}${m2}${f}`);
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    
    return Array.from(formulas);
}

function startSearch() {
    if (isSearching) {
        showInfo('Proses sedang berjalan!', 'warning');
        return;
    }
    
    if (!validateInputs()) {
        showInfo('Mohon periksa input Anda!', 'error');
        return;
    }
    
    const input = document.getElementById('numbers').value.trim();
    const digitCount = parseInt(document.getElementById('digitCount').value) || 2;
    const modOffset = parseInt(document.getElementById('modOffset').value) || 1;
    
    if (!input) {
        showInfo('Masukkan minimal 2 angka 4D!', 'error');
        return;
    }
    
    const lines = input.split('\n').map(l => l.trim()).filter(l => /^\d{4}$/.test(l));
    if (lines.length < 3) {
        showInfo('Minimal butuh 3 angka 4D untuk prediksi yang akurat!', 'error');
        return;
    }
    
    dataHistory = lines;
    isSearching = true;
    document.getElementById('runBtn').disabled = true;
    document.getElementById('stopBtn').disabled = false;
    
    showInfo(`Memulai analisis dengan ${lines.length} data‚Ä¶`, 'progress');
    document.getElementById('bestAccuracy').textContent = '0%';
    document.getElementById('progressFill').style.width = '0%';
    
    // Clear previous results
    bestResults = [];
    
    setTimeout(() => {
        try {
            const formulas = generateOptimizedFormulas();
            document.getElementById('formulaCount').textContent = formulas.length.toLocaleString();
            
            showInfo(`‚úÖ ${formulas.length.toLocaleString()} rumus dibuat. Menguji‚Ä¶`, 'progress');
            
            let processed = 0;
            let bestAccuracy = 0;
            const topFormulas = [];
            
            function processFormulas() {
                if (!isSearching) {
                    finishSearch(topFormulas, digitCount, modOffset, lines);
                    return;
                }
                
                const batchSize = Math.min(100, formulas.length - processed);
                const end = processed + batchSize;
                
                for (let i = processed; i < end; i++) {
                    try {
                        const res = testFormula(formulas[i], digitCount, modOffset, lines);
                        if (res.attempts > 0 && res.accuracy > 0) {
                            topFormulas.push({ formula: formulas[i], ...res });
                            
                            // Keep only top 10
                            topFormulas.sort((a, b) => b.accuracy - a.accuracy);
                            if (topFormulas.length > 10) {
                                topFormulas.pop();
                            }
                            
                            if (res.accuracy > bestAccuracy) {
                                bestAccuracy = res.accuracy;
                                document.getElementById('bestAccuracy').textContent = `${(bestAccuracy * 100).toFixed(1)}%`;
                            }
                        }
                    } catch (e) {
                        // Skip invalid formulas
                    }
                }
                
                processed += batchSize;
                const progress = (processed / formulas.length) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                
                showInfo(`üîç Proses: ${progress.toFixed(1)}% (${processed}/${formulas.length}) ‚Äî Akurasi terbaik: ${(bestAccuracy * 100).toFixed(1)}%`, 'progress');
                
                if (processed < formulas.length) {
                    searchTimeout = setTimeout(processFormulas, 10);
                } else {
                    finishSearch(topFormulas, digitCount, modOffset, lines);
                }
            }
            
            processFormulas();
            
        } catch (e) {
            showInfo(`Error: ${e.message}`, 'error');
            console.error(e);
            isSearching = false;
            document.getElementById('runBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
    }, 100);
}

function stopSearch() {
    isSearching = false;
    if (searchTimeout) {
        clearTimeout(searchTimeout);
        searchTimeout = null;
    }
    document.getElementById('runBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
    showInfo('Proses dihentikan oleh pengguna.', 'warning');
}

function finishSearch(topFormulas, digitCount, modOffset, data) {
    isSearching = false;
    document.getElementById('runBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
    
    if (topFormulas.length === 0) {
        showInfo('Tidak ada rumus yang berhasil diuji. Coba tambah data atau kurangi digit.', 'error');
        return;
    }
    
    // Sort by accuracy and hits
    topFormulas.sort((a, b) => {
        if (b.accuracy !== a.accuracy) return b.accuracy - a.accuracy;
        return b.hits - a.hits;
    });
    
    const top3 = topFormulas.slice(0, 3);
    let output = '';
    
    // Header
    output += '='.repeat(50) + '\n';
    output += 'üéØ HASIL PREDIKSI AUTO MOD+\n';
    output += `üìä Data: ${data.length} angka | Digit: ${digitCount} | Mod: +${modOffset}\n`;
    output += '='.repeat(50) + '\n\n';
    
    // Best formula predictions
    const bestRumus = top3[0];
    output += 'üîÆ PREDIKSI PER DATA:\n';
    output += '‚îÄ'.repeat(50) + '\n';
    
    for (let p of bestRumus.predictions) {
        const hitMark = p.hit ? '‚úÖ' : '‚ùå';
        output += `${p.number} ‚Üí AI=${p.ai} ‚Üí Pred=${p.pred} ${hitMark} (Aktual: ${p.actual})\n`;
    }
    
    // Next prediction
    output += '\nüîÆ PREDIKSI BERIKUTNYA:\n';
    output += '‚îÄ'.repeat(50) + '\n';
    try {
        const lastAI = calculateAI(bestRumus.formula, data.length - 1, data);
        const lastPred = generatePrediction(lastAI, digitCount, modOffset);
        output += `${data[data.length - 1]} ‚Üí AI=${lastAI} ‚Üí Prediksi = ${lastPred}\n`;
        output += `üìÖ Prediksi untuk periode berikutnya: ${lastPred}\n`;
    } catch (e) {
        output += `‚ö†Ô∏è Tidak bisa prediksi terakhir: ${e.message}\n`;
    }
    
    // Top formulas
    output += '\nüèÜ RUMUS TERBAIK:\n';
    output += '‚îÄ'.repeat(50) + '\n';
    top3.forEach((r, i) => {
        const acc = (r.accuracy * 100).toFixed(1);
        const mark = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : 'ü•â';
        output += `${mark} ${r.formula}\n`;
        output += `   ‚Üí Akurasi: ${acc}% (${r.hits}/${r.attempts} data)\n`;
    });
    
    // Additional stats
    if (topFormulas.length > 3) {
        output += '\nüìà STATISTIK LAINNYA:\n';
        output += '‚îÄ'.repeat(50) + '\n';
        output += `Total rumus diuji: ${topFormulas.length}\n`;
        output += `Rumus dengan akurasi >70%: ${topFormulas.filter(f => f.accuracy > 0.7).length}\n`;
        output += `Rumus dengan akurasi >80%: ${topFormulas.filter(f => f.accuracy > 0.8).length}\n`;
    }
    
    output += '\n' + '='.repeat(50) + '\n';
    output += '‚ö†Ô∏è Catatan: Prediksi ini berdasarkan pola historis.\n';
    output += 'Gunakan dengan bijak dan tanggung jawab.\n';
    
    document.getElementById('resultOutput').textContent = output;
    showInfo(`‚úÖ Analisis selesai! Akurasi terbaik: ${(bestRumus.accuracy * 100).toFixed(1)}%`, 'success');
}

function copyOutput() {
    const text = document.getElementById('resultOutput').textContent.trim();
    if (!text || text.includes('Hasil akan muncul')) {
        showInfo('Tidak ada output untuk disalin!', 'error');
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        showCopyNotification();
    }).catch(() => {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        showCopyNotification();
    });
}

function saveResults() {
    const text = document.getElementById('resultOutput').textContent.trim();
    if (!text || text.includes('Hasil akan muncul')) {
        showInfo('Tidak ada hasil untuk disimpan!', 'error');
        return;
    }
    
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prediksi-mod-plus-${new Date().toISOString().slice(0,10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showInfo('Hasil berhasil disimpan!', 'success');
}

function clearAll() {
    if (isSearching) {
        showInfo('Hentikan proses terlebih dahulu!', 'warning');
        return;
    }
    
    document.getElementById('numbers').value = '';
    document.getElementById('resultOutput').textContent = '// Hasil akan muncul di sini setelah klik "CARI RUMUS & PREDIKSI"\n\n// Format output:\n// - Prediksi untuk setiap data\n// - Rumus terbaik dengan akurasi\n// - Prediksi untuk periode berikutnya';
    document.getElementById('digitCount').value = '2';
    document.getElementById('modOffset').value = '1';
    document.getElementById('dataCount').textContent = '0';
    document.getElementById('formulaCount').textContent = '0';
    document.getElementById('bestAccuracy').textContent = '0%';
    document.getElementById('progressFill').style.width = '0%';
    
    document.getElementById('digitCount').classList.remove('invalid');
    document.getElementById('modOffset').classList.remove('invalid');
    
    showInfo('Input dan hasil telah dihapus.', 'success');
}

function showInfo(msg, type) {
    const el = document.getElementById('info');
    el.innerHTML = msg;
    el.className = 'info';
    if (type) el.classList.add(type);
}

function showCopyNotification() {
    const n = document.getElementById('copyNotification');
    n.classList.add('show');
    setTimeout(() => n.classList.remove('show'), 2000);
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateDataCount();
    document.getElementById('numbers').addEventListener('input', updateDataCount);
    document.getElementById('numbers').addEventListener('input', function() {
        this.classList.remove('invalid');
    });
});
</script>
</body>
</html>
