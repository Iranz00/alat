<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools Data - RAN</title>
<style>
* { 
    margin:0;
    padding:0;
    box-sizing:border-box;
}
body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    min-height: 100vh;
    padding: 15px;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    overflow-x: hidden;
    transition: all 0.3s ease;
}
.container { 
    max-width:1200px;
    width:100%;
    margin:0 auto;
    background:white;
    border-radius:12px;
    padding:20px;
    box-shadow:0 12px 24px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}
.header { 
    text-align:center;
    margin-bottom:20px;
}
h1 { 
    color:#2d3748;
    margin-bottom:6px;
    font-size:1.8rem;
    font-weight:700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
}
.subtitle { 
    text-align:center;
    color:#718096;
    font-size:14px;
    margin-bottom:20px;
    line-height:1.5;
    transition: all 0.3s ease;
}
/* Theme Toggle */
.theme-toggle {
    text-align: center;
    margin-bottom: 15px;
}
.theme-toggle button {
    background: linear-gradient(135deg, #4a5568, #718096);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 18px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}
.theme-toggle button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}

/* Tab Styles */
.tab-container {
    margin-bottom: 15px;
}
.tab-buttons {
    display: flex;
    background: #f8fafc;
    border-radius: 8px;
    padding: 4px;
    margin-bottom: 15px;
}
.tab-btn {
    flex: 1;
    padding: 10px 16px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}
.tab-btn.active {
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    color: #667eea;
}
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}

/* Common Styles */
.input-section {
    margin-bottom:15px;
}
.textarea-container {
    position: relative;
    margin-bottom: 12px;
}
.input-box {
    padding: 16px;
    border: 1.5px solid #e2e8f0;
    border-radius: 8px;
    background: #f8fafc;
    transition: all 0.3s ease;
    position: relative;
}
.input-box h3 {
    color: #2d3748;
    margin-bottom: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

/* REKAP DATA - Textarea Lebar */
.rekap-textarea {
    width:100%;
    height:150px;
    padding:16px;
    border:1.5px solid #e2e8f0;
    border-radius:8px;
    font-size:14px;
    resize:vertical;
    font-family: 'Courier New', monospace;
    transition: all 0.3s ease;
    background: #f8fafc;
}

/* BBFS & KOMBINASI - Input Sempit */
.bbfs-input, .kombinasi-input {
    width:100%;
    padding:10px;
    border:1.5px solid #e2e8f0;
    border-radius:6px;
    font-size:14px;
    font-family: 'Courier New', monospace;
    transition: all 0.3s ease;
}

textarea:focus, input:focus { 
    border-color:#667eea;
    outline:none;
    background: white;
    box-shadow: 0 0 0 2.5px rgba(102, 126, 234, 0.1);
}

.button-group { 
    display:flex;
    gap:10px;
    margin-bottom:15px;
    flex-wrap: nowrap;
}
button { 
    flex: 1;
    min-width: 100px;
    padding: 12px 10px;
    border:none;
    border-radius:8px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}
.btn-submit { 
    background: linear-gradient(135deg, #009688, #00796B);
    color:white;
    box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
}
.btn-copy { 
    background:linear-gradient(135deg, #2196F3, #1976D2);
    color:white;
    box-shadow: 0 3px 10px rgba(33, 150, 243, 0.3);
}
.btn-clean {
    background:linear-gradient(135deg, #f44336, #f44336);
    color:white;
    box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);
}
button:hover { 
    transform:translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}
button:active {
    transform:translateY(-1px);
}
.info { 
    background:#e3f2fd;
    padding:14px;
    border-radius:8px;
    margin-bottom:15px;
    text-align:center;
    font-weight:500;
    border-left:3px solid #2196F3;
    transition: all 0.3s ease;
}
/* Toast mengambang (khusus SALIN / HAPUS / SELESAI) */
.toast{
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    opacity: 1;
    pointer-events: none;
    max-width: calc(100% - 24px);
    width: max-content;
    padding: 14px;
    border-radius: 10px;
    margin: 0;
    text-align: center;
    font-weight: 700;
    border-left: 3px solid #2196F3;
    background: #e3f2fd;
    color: #1565c0;
    transition: opacity 0.25s ease, transform 0.25s ease;
    box-shadow: 0 10px 28px rgba(0,0,0,0.18);
}
.toast.hide{
    opacity: 0;
    transform: translateX(-50%) translateY(-10px);
}
/* Warna khusus toast */
.toast.toast-copy{
    background:#e8f5e8;
    border-left-color:#4CAF50;
    color:#2e7d32;
}
.toast.toast-delete{
    background:#ffebee;
    border-left-color:#f44336;
    color:#c62828;
}
.toast.toast-done{
    background:#e3f2fd;
    border-left-color:#2196F3;
    color:#1565c0;
}
/* Dark theme untuk toast */
body.dark-theme .toast.toast-copy{
    background:#2d5c2d;
    color:#e8f5e8;
}
body.dark-theme .toast.toast-delete{
    background:#5c2d2d;
    color:#ffebee;
}
body.dark-theme .toast.toast-done{
    background:#2f4b63;
    color:#e3f2fd;
}

.info.success {
    background:#e8f5e8;
    border-left-color:#4CAF50;
    color:#2e7d32;
}
.info.error {
    background:#ffebee;
    border-left-color:#f44336;
    color:#c62828;
}
.info.warning {
    background:#fff3e0;
    border-left-color:#ff9800;
    color:#e65100;
}
.error-details {
    background: #ffebee;
    border: 1px solid #f44336;
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 12px;
    font-size: 13px;
}
.error-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px solid #ffcdd2;
}
.error-item:last-child {
    border-bottom: none;
}
.error-line {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #c62828;
}
.error-reason {
    color: #d32f2f;
    font-size: 12px;
    background: #ffcdd2;
    padding: 3px 6px;
    border-radius: 3px;
}

/* Counter Styles */
.input-counter {
    position: absolute;
    bottom: 8px;
    right: 12px;
    background: linear-gradient(135deg, #FFD700, #FFC400);
    color: #333;
    padding: 5px 10px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 600;
}
.output-counter {
    background: linear-gradient(135deg, #FFD700, #FFC400);
    color: #333;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 1.5px 6px rgba(0,0,0,0.1);
}

.output-section h3 {
    color:#2d3748;
    margin-bottom:10px;
    font-size:1rem;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
}
.output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
.total-value {
    background: linear-gradient(135deg, #FFD700, #FFC400);
    color: #333;
    padding: 5px 10px;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 600;
}

/* Breakdown Styles */
.input-breakdown, .output-breakdown {
    margin-top: 12px;
    padding: 12px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1.5px solid #e2e8f0;
    transition: all 0.3s ease;
}

.breakdown-cards {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
}

.breakdown-card {
    background: white;
    padding: 10px 14px;
    border-radius: 8px;
    text-align: center;
    min-width: 65px;
    box-shadow: 0 1.5px 3px rgba(0,0,0,0.1);
    border: 1px solid #e2e8f0;
}

.breakdown-label {
    font-size: 11px;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 3px;
}

.breakdown-value {
    font-size: 13px;
    font-weight: 700;
    color: #2d3748;
}

.markdown-output { 
    background:#1a202c;
    color:#e2e8f0;
    padding:18px;
    border-radius:8px;
    margin-top:8px;
    font-family:'Courier New', monospace;
    white-space:pre-wrap;
    max-height:320px;
    overflow-y:auto;
    line-height:1.4;
    border:1px solid #2d3748;
    font-size:13px;
}
.markdown-output::-webkit-scrollbar {
    width:6px;
}
.markdown-output::-webkit-scrollbar-track {
    background:#2d3748;
    border-radius:3px;
}
.markdown-output::-webkit-scrollbar-thumb {
    background:#4a5568;
    border-radius:3px;
}
.markdown-output::-webkit-scrollbar-thumb:hover {
    background:#718096;
}

/* BBFS & Kombinasi Specific Styles */
.digit-selection {
    background:#f8f9fa;
    padding:12px;
    border-radius:8px;
    margin-bottom:12px;
    border:1.5px solid #e9ecef;
    transition: all 0.3s ease;
}
.digit-selection h3 {
    margin-bottom:8px;
    color:#333;
    font-size:13px;
    text-align:center;
    transition: all 0.3s ease;
}
.checkbox-group {
    display:flex;
    justify-content:center;
    gap:12px;
    flex-wrap:wrap;
}
.checkbox-item {
    display:flex;
    align-items:center;
    gap:4px;
}
.checkbox-item input[type="checkbox"] {
    width:14px;
    height:14px;
}
.checkbox-item label {
    font-size:13px;
    color:#333;
    cursor:pointer;
    transition: all 0.3s ease;
}
.warning {
    background:#fff3cd;
    color:#856404;
    padding:8px;
    border-radius:4px;
    margin-bottom:12px;
    text-align:center;
    font-size:13px;
    border:1px solid #ffeaa7;
    transition: all 0.3s ease;
}
.output-container {
    border:1.5px solid #ddd;
    border-radius:8px;
    padding:12px;
    background:#f9f9f9;
    transition: all 0.3s ease;
}
.output-count {
    background:#667eea;
    color:white;
    padding:3px 6px;
    border-radius:10px;
    font-size:11px;
}
.loading {
    display:none;
    text-align:center;
    color:#667eea;
    margin:8px 0;
}

/* Dark Theme Styles */
body.dark-theme {
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
}
body.dark-theme .container {
    background: #2d3748;
    color: #e2e8f0;
    box-shadow: 0 12px 24px rgba(0,0,0,0.3);
}
body.dark-theme h1 {
    color: #e2e8f0;
}
body.dark-theme .subtitle {
    color: #a0aec0;
}
body.dark-theme .input-box {
    background: #4a5568;
    border-color: #718096;
}
body.dark-theme .input-box h3 {
    color: #e2e8f0;
}
body.dark-theme .rekap-textarea,
body.dark-theme .bbfs-input,
body.dark-theme .kombinasi-input {
    background: #4a5568;
    border-color: #718096;
    color: #e2e8f0;
}
body.dark-theme .rekap-textarea:focus,
body.dark-theme .bbfs-input:focus,
body.dark-theme .kombinasi-input:focus {
    border-color: #667eea;
    background: #4a5568;
    box-shadow: 0 0 0 2.5px rgba(102, 126, 234, 0.2);
}
body.dark-theme .info {
    background: #4a5568;
    border-left-color: #667eea;
    color: #e2e8f0;
}
body.dark-theme .info.success {
    background: #2d5c2d;
    border-left-color: #4CAF50;
    color: #e8f5e8;
}
body.dark-theme .info.error {
    background: #5c2d2d;
    border-left-color: #f44336;
    color: #ffebee;
}
body.dark-theme .info.warning {
    background: #5c4d2d;
    border-left-color: #ff9800;
    color: #fff3e0;
}
body.dark-theme .error-details {
    background: #5c2d2d;
    border-color: #f44336;
}
body.dark-theme .error-line {
    color: #ffebee;
}
body.dark-theme .error-reason {
    background: #7a3d3d;
    color: #ffebee;
}
body.dark-theme .output-section h3 {
    color: #e2e8f0;
}
body.dark-theme .theme-toggle button {
    background: linear-gradient(135deg, #4a5568, #718096);
}
body.dark-theme .tab-buttons {
    background: #4a5568;
}
body.dark-theme .tab-btn.active {
    background: #2d3748;
    color: #667eea;
}
body.dark-theme .input-counter,
body.dark-theme .output-counter,
body.dark-theme .total-value {
    background: linear-gradient(135deg, #d4af37, #b8941f);
    color: #1a202c;
}
body.dark-theme .digit-selection {
    background: #4a5568;
    border-color: #718096;
}
body.dark-theme .digit-selection h3 {
    color: #e2e8f0;
}
body.dark-theme .checkbox-item label {
    color: #e2e8f0;
}
body.dark-theme .warning {
    background: #5c4d2d;
    color: #ffebee;
    border-color: #856404;
}
body.dark-theme .output-container {
    background: #4a5568;
    border-color: #718096;
}
body.dark-theme .input-breakdown,
body.dark-theme .output-breakdown {
    background: #4a5568;
    border-color: #718096;
}
body.dark-theme .breakdown-card {
    background: #2d3748;
    border-color: #718096;
}
body.dark-theme .breakdown-label {
    color: #e2e8f0;
}
body.dark-theme .breakdown-value {
    color: #ffffff;
}

.theme-toggle {
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    margin: 15px 0 !important;
}

.theme-toggle button {
    display: inline-flex !important;
    margin: 0 auto !important;
}

@media (max-width: 768px) {
    /* CTK TABLE MOBILE */
    .rekap-table thead th{font-size:13px; padding:9px 6px;}
    .rekap-table td{padding:9px 6px;}
    .rekap-label{font-size:11px; padding-left:10px !important;}
    .rekap-values{width:80%; font-size:11px; line-height:1.3; text-align:center; padding:10px 8px !important;}
    .rekap-count{font-size:11px; font-weight:800; text-align:center; margin-top:6px;}
    body {
        padding: 10px;
        align-items: flex-start;
    }
    .container {
        padding:16px;
        margin:0;
    }
    h1 {
        font-size:1.6rem;
    }
    .button-group {
        flex-wrap: wrap;
    }
    button {
        min-width: calc(50% - 5px);
    }
    .rekap-textarea {
        height:150px;
    }
    .markdown-output {
        max-height:600px;
    }
    .output-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    .error-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    .tab-buttons {
        flex-direction: column;
    }
    .input-counter {
        position: relative;
        bottom: auto;
        right: auto;
        margin-top: 8px;
        display: inline-block;
    }
    .breakdown-cards {
        gap: 8px;
    }
    .breakdown-card {
        padding: 8px 10px;
        min-width: 60px;
    }
}
/* =========================
   CT & KUMAT - TABEL OUTPUT
   ========================= */
.ctk-output{
    border:1.5px solid #ddd;
    border-radius:8px;
    overflow:hidden;
    background:#fff;
}
.ctk-empty{display:none;}
.rekap-table{
    width:100%;
    border-collapse:collapse;
    table-layout:fixed;
}
.rekap-table thead th{
    background: linear-gradient(180deg, #1e88e5, #1565c0);
    color:#fff;
    padding:10px 8px;
    text-align:center;
    font-weight:800;
    font-size:15px;
}
.rekap-table td{
    border-top:1px solid rgba(0,0,0,0.12);
    border-right:1px solid rgba(0,0,0,0.12);
    padding:12px 10px;
    vertical-align:middle;
    background:#fff;
}
.rekap-table td:last-child{ border-right:none; }
.rekap-label{
    width:20%;
    text-align:left;
    font-weight:800;
    font-size:14px;
    padding:10px 8px 10px 10px !important;
    white-space:nowrap;
}
.rekap-values{
    width:80%;
    text-align:center;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size:14px;
    line-height:1.35;
    word-break:break-word;
}
.rekap-count{
    margin-top:6px;
    font-weight:900;
    font-size:12px;
    color:#000;;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.rekap-values .nums{
    display:block;
}
.rekap-label.rank-1{ color:#000; }
.rekap-label.rank-2{ color:#000; }
.rekap-label.rank-3{ color:#000; }
.rekap-label.rank-4,
.rekap-label.rank-5,
.rekap-label.rank-6,
.rekap-label.rank-7,
.rekap-label.rank-8,
.rekap-label.rank-9,
.rekap-label.rank-10{ color:#000; }

/* Dark theme untuk tabel */
body.dark-theme .ctk-output{
    border-color:#718096;
    background:#2d3748;
}
body.dark-theme .rekap-table td{
    border-top:1px solid rgba(255,255,255,0.14);
    border-right:1px solid rgba(255,255,255,0.14);
    background:#2d3748;
    color:#e2e8f0;
}
body.dark-theme .rekap-table td:last-child{ border-right:none; }
body.dark-theme .rekap-count{ color:#e2e8f0; }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üõ†Ô∏è TOOLS DATA üõ†Ô∏è</h1>
    </div>
    
    <div class="theme-toggle">
        <button id="themeButton" onclick="toggleTheme()">
            <span>üåô</span>
            <span>Mode Gelap</span>
        </button>
    </div>
    
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('tab1')">
                <span>üìä</span>
                <span>REKAP DATA</span>
            </button>
            <button class="tab-btn" onclick="switchTab('tab2')">
                <span>üé∞</span>
                <span>GENERATOR BBFS</span>
            </button>
            <button class="tab-btn" onclick="switchTab('tab3')">
                <span>üî¢</span>
                <span>POLTAR 4D/3D/2D</span>
            </button>
            <button class="tab-btn" onclick="switchTab('tab4')">
                <span>üéØ</span>
                <span>REKAP CT & KUMAT</span>
            </button>
        </div>
        
        <!-- TAB 1: REKAP DATA -->
        <div id="tab1" class="tab-content active">
        
        <!-- Input Breakdown -->
        <div class="input-breakdown" id="inputBreakdown" style="display: none;">
            <div class="breakdown-cards">
                <div class="breakdown-card">
                    <div class="breakdown-label">4D</div>
                    <div class="breakdown-value" id="input4D">0 Line</div>
                </div>
                <div class="breakdown-card">
                    <div class="breakdown-label">3D</div>
                    <div class="breakdown-value" id="input3D">0 Line</div>
                </div>
                <div class="breakdown-card">
                    <div class="breakdown-label">2D</div>
                    <div class="breakdown-value" id="input2D">0 Line</div>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 20px;"></div>
        
            <div class="input-section">
                <div class="textarea-container">
                    <textarea id="inputData" class="rekap-textarea" placeholder="CONTOH:
SIWAR:
01*02#1000, 
01#2000, 
SURAT:
03*04#5000, 
05#10000," oninput="updateInputCounter()"></textarea>
                    <div class="input-counter" id="inputCounter">Total: 0</div>
                </div>
                
                <div class="button-group">
                    <button class="btn-submit" onclick="prosesData()">
                        <span>üöÄ</span>
                        <span>PROSES DATA</span>
                    </button>
                    <button class="btn-copy" onclick="copyMarkdown()">
                        <span>üìã</span>
                        <span>SALIN OUTPUT</span>
                    </button>
                    <button class="btn-clean" onclick="cleanAll()">
                        <span>üóëÔ∏è</span>
                        <span>CLEAR</span>
                    </button>
                </div>
            </div>
            
            <div class="info" id="info">
                üí° Masukkan data Anda dan klik "PROSES DATA" - Program otomatis mengekstrak pattern angka#angka
            </div>

            <div id="errorDetails" style="display: none;"></div>

            <div class="output-section">
                <div class="output-header">
                    <h3>üìä Hasil Output:</h3>
                    <div class="total-value" id="outputTotal">Total: 0</div>
                </div>
                
                <!-- Output Breakdown -->
                <div class="output-breakdown" id="outputBreakdown" style="display: none;">
                    <div class="breakdown-cards">
                        <div class="breakdown-card">
                            <div class="breakdown-label">4D</div>
                            <div class="breakdown-value" id="output4D">0 Line</div>
                        </div>
                        <div class="breakdown-card">
                            <div class="breakdown-label">3D</div>
                            <div class="breakdown-value" id="output3D">0 Line</div>
                        </div>
                        <div class="breakdown-card">
                            <div class="breakdown-label">2D</div>
                            <div class="breakdown-value" id="output2D">0 Line</div>
                        </div>
                    </div>
                </div>
                
                <div class="markdown-output" id="markdownOutput">// Output akan muncul di sini setelah proses data...</div>
            </div>
        </div>
        
        <!-- TAB 2: GENERATOR BBFS -->
        <div id="tab2" class="tab-content">
            <div class="input-section">
                <div class="input-group">
                    <div class="input-box">
                        <input type="text" id="inputAngka" class="bbfs-input" placeholder="Masukkan angka 2-6 digit" maxlength="6">
                    </div>
                </div>
                
                <div style="margin-top: 20px;"></div>
                
                <div class="digit-selection">
                    <h3>üìä PILIH DIGIT YANG AKAN DI-GENERATE</h3>
                    <div class="checkbox-group" id="digitCheckboxes">
                        <!-- Checkbox akan di-generate otomatis oleh JavaScript -->
                    </div>
                </div>
                
                <div class="loading" id="loading">‚è≥ Sedang memproses... Harap tunggu!</div>
                
                <div class="button-group">
                    <button class="btn-submit" onclick="generatePermutasi()" id="btnGenerate">
                        <span>üé≤</span>
                        <span>GENERATE</span>
                    </button>
                    <button class="btn-copy" onclick="copyOutput()">
                        <span>üìã</span>
                        <span>SALIN OUTPUT</span>
                    </button>
                    <button class="btn-clean" onclick="clearAllBBFS()">
                        <span>üóëÔ∏è</span>
                        <span>CLEAR</span>
                    </button>
                </div>
            </div>
            
            <div class="info" id="infoBBFS">Masukkan angka 2-6 digit, pilih digit yang diinginkan, lalu klik GENERATE</div>

            <div class="output-container">
                <div class="output-header">
                    <h3>üé≤ Hasil Permutasi:</h3>
                    <div class="output-count" id="countOutput">0 hasil</div>
                </div>
                <div class="markdown-output" id="outputPermutasi">// Hasil akan muncul di sini dengan format kelompok digit</div>
            </div>
        </div>
        
        <!-- TAB 3: POLTAR 4D/3D/2D -->
        <div id="tab3" class="tab-content">
            <div class="input-section">
                <div class="input-group">
                    <div class="input-box">
                        <input type="text" id="inputKelompok" class="kombinasi-input" placeholder="Masukkan angka dipisahkan koma (contoh: 123,678,901,234)">
                    </div>
                </div>
                
                <div style="margin-top: 20px;"></div>
                
                <div class="digit-selection">
                    <h3>üìä PILIH DIGIT YANG AKAN DI-GENERATE</h3>
                    <div class="checkbox-group" id="kombinasiCheckboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="kombinasi4D" value="4D" checked>
                            <label for="kombinasi4D">4D</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="kombinasi3D" value="3D" checked>
                            <label for="kombinasi3D">3D</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="kombinasi2D" value="2D" checked>
                            <label for="kombinasi2D">2D</label>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-submit" onclick="generateKombinasi()">
                        <span>üé≤</span>
                        <span>GENERATE</span>
                    </button>
                    <button class="btn-copy" onclick="copyKombinasi()">
                        <span>üìã</span>
                        <span>SALIN OUTPUT</span>
                    </button>
                    <button class="btn-clean" onclick="clearKombinasi()">
                        <span>üóëÔ∏è</span>
                        <span>CLEAR</span>
                    </button>
                </div>
            </div>
            
            <div class="info" id="infoKombinasi">
                üí° Masukkan kelompok angka dipisahkan koma. Program akan generate kombinasi 4D, 3D, dan 2D otomatis.
            </div>

            <div class="output-section">
                <div class="output-header">
                    <h3>üî¢ Hasil Kombinasi:</h3>
                    <div class="total-value" id="totalKombinasi">0 kombinasi</div>
                </div>
                <div class="markdown-output" id="outputKombinasi">// Hasil kombinasi akan muncul di sini...</div>
            </div>
        </div>
        
        <!-- TAB 4: REKAP CT & KUMAT -->
<div id="tab4" class="tab-content">
    <div class="input-section">
        <div class="textarea-container">
            <textarea id="inputCTKumat" class="rekap-textarea" placeholder="Pilih mode terlebih dahulu, lalu masukkan data"></textarea>
        </div>
        
        <div style="margin-top: 20px;"></div>
        
        <div class="digit-selection">
            <h3>üìä PILIH MODE YANG AKAN DI-REKAP</h3>
            <div class="checkbox-group" id="modeCheckboxes">
                <div class="checkbox-item">
                    <input type="radio" id="ModeCT" value="CT" name="modeSelection">
                    <label for="ModeCT">MODE CT</label>
                </div>
                <div class="checkbox-item">
                    <input type="radio" id="ModeKumat" value="Kumat" name="modeSelection">
                    <label for="ModeKumat">MODE KUMAT</label>
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-submit" onclick="prosesRekapCTKumat()">
                <span>üöÄ</span>
                <span>GENERATE</span>
            </button>
            <button class="btn-copy" onclick="copyOutputCTKumat()">
                <span>üìã</span>
                <span>SALIN OUTPUT</span>
            </button>
            <button class="btn-clean" onclick="cleanAllCTKumat()">
                <span>üóëÔ∏è</span>
                <span>CLEAR</span>
            </button>
        </div>
    </div>
    
    <div class="info" id="infoCTKumat">
        üí° Pilih mode terlebih dahulu, lalu masukkan data
    </div>

    <div class="output-section">
    <h3>üìä Hasil Rekap CT & Kumat:</h3>
    <div id="ctKumatOutput" class="ctk-output">
        <div class="ctk-empty" id="ctkEmpty">// Pilih mode dan masukkan data...</div>
    </div>
</div>
</div>
</div>

<script>

// =============================================
// DOM CACHE (lebih ringan untuk mobile)
// =============================================
const _dom = Object.create(null);
function $(id){ return _dom[id] || (_dom[id] = document.getElementById(id)); }

// =============================================
// THEME TOGGLE
// =============================================
function toggleTheme() {
    const body = document.body;
    const themeButton = document.getElementById('themeButton');
    
    body.classList.toggle('dark-theme');
    
    if (body.classList.contains('dark-theme')) {
        themeButton.innerHTML = '<span>‚òÄÔ∏è</span><span>Mode Terang</span>';
        localStorage.setItem('theme', 'dark');
    } else {
        themeButton.innerHTML = '<span>üåô</span><span>Mode Gelap</span>';
        localStorage.setItem('theme', 'light');
    }
}

function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    const themeButton = document.getElementById('themeButton');
    
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeButton.innerHTML = '<span>‚òÄÔ∏è</span><span>Mode Terang</span>';
    }
}

// =============================================
// TAB MANAGEMENT
// =============================================
function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(tabName).classList.add('active');
    event.currentTarget.classList.add('active');
}

// =============================================
// TAB 1: REKAP DATA FUNCTIONS
// =============================================
function extractValidPatterns(line) {
    const patterns = [];
    const regex = /([0-9*]+)#(\d{3,})/g;
    
    let match;
    while ((match = regex.exec(line)) !== null) {
        const fullPattern = match[0];
        const keyPart = match[1];
        const valuePart = match[2];
        const value = parseInt(valuePart);
        
        if (value >= 100 && /[0-9]/.test(keyPart)) {
            patterns.push({
                fullPattern: fullPattern,
                keyPart: keyPart,
                value: value,
                originalLine: line
            });
        }
    }
    
    return patterns;
}

function updateInputCounter() {
    const input = document.getElementById('inputData').value.trim();
    let total = 0;
    let lineCount4D = 0;
    let lineCount3D = 0;
    let lineCount2D = 0;
    
    const breakdownContainer = document.getElementById('inputBreakdown');
    
    if (input) {
        const lines = input.split(',').map(line => line.trim()).filter(line => line);
        const individualKeyMap = {};
        
        lines.forEach(line => {
            const patterns = extractValidPatterns(line);
            patterns.forEach(pattern => {
                const keys = pattern.keyPart.split('*')
                    .map(k => k.trim())
                    .filter(k => k && /^\d+$/.test(k));
                
                if (keys.length > 0 && !isNaN(pattern.value)) {
                    keys.forEach(key => {
                        if (!individualKeyMap[key]) individualKeyMap[key] = 0;
                        individualKeyMap[key] += pattern.value;
                        
                        // Hitung line per digit
                        const digitLength = key.length;
                        if (digitLength === 4) lineCount4D++;
                        else if (digitLength === 3) lineCount3D++;
                        else if (digitLength === 2) lineCount2D++;
                    });
                }
            });
        });
        
        Object.values(individualKeyMap).forEach(value => {
            total += value;
        });
        
        // Tampilkan breakdown jika ada data
        if (total > 0) {
            breakdownContainer.style.display = 'block';
            document.getElementById('input4D').textContent = lineCount4D + ' Line';
            document.getElementById('input3D').textContent = lineCount3D + ' Line';
            document.getElementById('input2D').textContent = lineCount2D + ' Line';
        } else {
            breakdownContainer.style.display = 'none';
        }
    } else {
        breakdownContainer.style.display = 'none';
    }
    
    document.getElementById('inputCounter').textContent = `Total: ${total.toLocaleString()}`;
}

function validateLine(line) {
    const patterns = extractValidPatterns(line);
    if (patterns.length === 0) {
        return { isValid: false, reason: 'Tidak ditemukan pattern angka#angka dengan value ‚â•100', line: line };
    }
    return { isValid: true, reason: 'Valid', line: line, patterns: patterns };
}

function showErrorDetails(invalidLines) {
    const errorDetails = document.getElementById('errorDetails');
    if (invalidLines.length === 0) {
        errorDetails.style.display = 'none';
        return;
    }
    
    let errorHTML = `<div class="error-details"><div style="font-weight: bold; margin-bottom: 10px; color: #c62828;">‚ö†Ô∏è ${invalidLines.length} Data Tidak Valid:</div>`;
    invalidLines.forEach((item, index) => {
        errorHTML += `<div class="error-item"><span class="error-line">"${item.line}"</span><span class="error-reason">${item.reason}</span></div>`;
    });
    errorHTML += `</div>`;
    errorDetails.innerHTML = errorHTML;
    errorDetails.style.display = 'block';
}

function prosesData() {
    const input = document.getElementById('inputData').value.trim();
    if (!input) {
        setInfo('info', 'Masukkan data terlebih dahulu!', 'error');
        document.getElementById('errorDetails').style.display = 'none';
        return;
    }
    
    const lines = input.split(',').map(line => line.trim()).filter(line => line);
    const validationResults = lines.map(line => validateLine(line));
    const validLines = validationResults.filter(result => result.isValid);
    const invalidLines = validationResults.filter(result => !result.isValid);
    
    showErrorDetails(invalidLines);
    
    if (validLines.length === 0) {
        setInfo('info', 'Tidak ada data valid yang ditemukan!', 'error');
        return;
    }
    
    const allValidPatterns = [];
    validLines.forEach(result => {
        allValidPatterns.push(...result.patterns);
    });
    
    if (allValidPatterns.length === 0) {
        setInfo('info', 'Tidak ada data valid yang ditemukan!', 'error');
        return;
    }
    
    // Process data
    const individualKeyMap = {};
    allValidPatterns.forEach(pattern => {
        const keys = pattern.keyPart.split('*')
            .map(k => k.trim())
            .filter(k => k && /^\d+$/.test(k));
        
        if (keys.length > 0 && !isNaN(pattern.value)) {
            keys.forEach(key => {
                if (!individualKeyMap[key]) individualKeyMap[key] = 0;
                individualKeyMap[key] += pattern.value;
            });
        }
    });
    
    const valueMap = {};
    Object.entries(individualKeyMap).forEach(([key, value]) => {
        if (!valueMap[value]) valueMap[value] = [];
        valueMap[value].push(key);
    });
    
    const mergedData = Object.entries(valueMap)
        .map(([value, keys]) => ({
            keys: keys.sort((a, b) => a.localeCompare(b, undefined, {numeric: true})),
            value: parseInt(value)
        }))
        .sort((a, b) => b.value - a.value);
    
    const groups = { '4DIGIT': [], '3DIGIT': [], '2DIGIT': [] };
    mergedData.forEach(item => {
        const keys4 = [], keys3 = [], keys2 = [];
        item.keys.forEach(key => {
            if (/^\d+$/.test(key)) {
                const digitLength = key.length;
                if (digitLength === 4) keys4.push(key);
                else if (digitLength === 3) keys3.push(key);
                else if (digitLength === 2) keys2.push(key);
            }
        });
        if (keys4.length > 0) groups['4DIGIT'].push({ keys: keys4.sort((a, b) => a.localeCompare(b, undefined, {numeric: true})), value: item.value });
        if (keys3.length > 0) groups['3DIGIT'].push({ keys: keys3.sort((a, b) => a.localeCompare(b, undefined, {numeric: true})), value: item.value });
        if (keys2.length > 0) groups['2DIGIT'].push({ keys: keys2.sort((a, b) => a.localeCompare(b, undefined, {numeric: true})), value: item.value });
    });
    
    Object.keys(groups).forEach(group => {
        groups[group].sort((a, b) => b.value - a.value);
    });
    
    generateMarkdown(groups);
    
    if (invalidLines.length > 0 && validLines.length > 0) {
        setInfo('info', `Data berhasil diproses! ${allValidPatterns.length} pattern valid, ${invalidLines.length} tidak valid.`, 'warning');
    } else {
        setInfo('info', `Data berhasil diproses! ${allValidPatterns.length} pattern valid.`, 'success');
    }
    showToast('Tugas selesai!', 'done');
}

function generateMarkdown(groups) {
    const markdownOutput = document.getElementById('markdownOutput');
    const outputBreakdown = document.getElementById('outputBreakdown');
    let output = '';
    let totalOutputValue = 0;
    
    // Hitung line count per digit untuk OUTPUT
    let lineCount4D = 0;
    let lineCount3D = 0;
    let lineCount2D = 0;
    
    ['4DIGIT', '3DIGIT', '2DIGIT'].forEach(group => {
        if (groups[group] && groups[group].length > 0) {
            // Hitung breakdown
            const count = groups[group].reduce((sum, entry) => sum + entry.keys.length, 0);
            if (group === '4DIGIT') lineCount4D = count;
            else if (group === '3DIGIT') lineCount3D = count;
            else if (group === '2DIGIT') lineCount2D = count;
            
            const label = group.replace('DIGIT', 'D');
            output += `${label} (${count} line):\n`;
            
            groups[group].forEach(entry => {
                output += `${entry.keys.join('*')}#${entry.value},\n`;
                totalOutputValue += entry.value * entry.keys.length;
            });
            output += '\n';
        }
    });
    
    // breakdown output
    if (lineCount4D > 0 || lineCount3D > 0 || lineCount2D > 0) {
        outputBreakdown.style.display = 'block';
        document.getElementById('output4D').textContent = lineCount4D + ' Line';
        document.getElementById('output3D').textContent = lineCount3D + ' Line';
        document.getElementById('output2D').textContent = lineCount2D + ' Line';
    } else {
        outputBreakdown.style.display = 'none';
    }
    
    document.getElementById('outputTotal').textContent = `Total: ${totalOutputValue.toLocaleString()}`;
    markdownOutput.textContent = output || '// Tidak ada data yang diproses';
}

function copyMarkdown() {
    const markdownOutput = document.getElementById('markdownOutput');
    copyToClipboard(markdownOutput.textContent);
    showToast('Output berhasil disalin!', 'copy');
}

function cleanAll() {
    document.getElementById('inputData').value = '';
    document.getElementById('markdownOutput').textContent = '// Output akan muncul di sini setelah proses data...';
    document.getElementById('outputTotal').textContent = 'Total: 0';
    document.getElementById('inputCounter').textContent = 'Total: 0';
    document.getElementById('inputBreakdown').style.display = 'none';
    document.getElementById('outputBreakdown').style.display = 'none';
    document.getElementById('errorDetails').style.display = 'none';
    setInfo('info', 'üí° Masukkan data Anda dan klik "PROSES DATA"', 'default');
    showToast('Data berhasil dihapus!', 'delete');
}


// =============================================
// TAB 2: BBFS FUNCTIONS 
// =============================================
let selectedDigits = [];

function generatePermutasi() {
    const input = document.getElementById('inputAngka').value.trim();
    if (!input || !/^\d+$/.test(input)) {
        setInfo('infoBBFS', 'Input harus berupa angka!', 'error');
        return;
    }
    
    const digitCount = input.length;
    if (digitCount < 2 || digitCount > 6) {
        setInfo('infoBBFS', 'Masukkan 2-6 digit angka!', 'error');
        return;
    }
    
    if (selectedDigits.length === 0) {
        setInfo('infoBBFS', 'Pilih minimal satu digit!', 'error');
        return;
    }
    
    document.getElementById('btnGenerate').disabled = true;
    document.getElementById('loading').style.display = 'block';
    
    setTimeout(() => {
        const groupedResults = {};
        const inputDigits = input.split('');
        
        selectedDigits.forEach(length => {
            const groupKey = length + 'D';
            groupedResults[groupKey] = new Set();
            const combinations = generateCombinations(inputDigits, length);
            
            combinations.forEach(combination => {
                const permutations = generateAllPermutations(combination.join(''));
                permutations.forEach(perm => groupedResults[groupKey].add(perm));
            });
        });
        
        Object.keys(groupedResults).forEach(group => {
            groupedResults[group] = Array.from(groupedResults[group]).sort();
        });
        
        const output = formatGroupedOutput(groupedResults);
        const totalResults = calculateTotalResults(groupedResults);
        
        document.getElementById('outputPermutasi').textContent = output;
        document.getElementById('countOutput').textContent = `${totalResults} hasil`;
        
        document.getElementById('btnGenerate').disabled = false;
        document.getElementById('loading').style.display = 'none';
        setInfo('infoBBFS', `Berhasil generate ${totalResults} permutasi!`, 'success');
        showToast('Tugas selesai!', 'done');
    }, 10);
}

function generateCombinations(arr, length) {
    const results = [];
    function combine(start, current) {
        if (current.length === length) {
            results.push([...current]);
            return;
        }
        for (let i = start; i < arr.length; i++) {
            current.push(arr[i]);
            combine(i + 1, current);
            current.pop();
        }
    }
    combine(0, []);
    return results;
}

function generateAllPermutations(str) {
    const results = [];
    function permute(arr, memo = []) {
        if (arr.length === 0) results.push(memo.join(''));
        else {
            for (let i = 0; i < arr.length; i++) {
                const current = arr.slice();
                const next = current.splice(i, 1);
                permute(current, memo.concat(next));
            }
        }
    }
    permute(str.split(''));
    return results;
}

function formatGroupedOutput(groupedResults) {
    let output = '';
    const sortedGroups = Object.keys(groupedResults).sort((a, b) => parseInt(b) - parseInt(a));
    sortedGroups.forEach(group => {
        if (groupedResults[group].length > 0) {
            output += `${group} (${groupedResults[group].length} line):\n`;
            output += `${groupedResults[group].join('*')}*\n\n`;
        }
    });
    return output;
}

function calculateTotalResults(groupedResults) {
    return Object.values(groupedResults).reduce((sum, group) => sum + group.length, 0);
}

function copyOutput() {
    copyToClipboard(document.getElementById('outputPermutasi').textContent);
    showToast('Output berhasil disalin!', 'copy');
}

function clearAllBBFS() {

    document.getElementById('inputAngka').value = '';
    document.getElementById('outputPermutasi').textContent = '// Hasil akan muncul di sini dengan format kelompok digit';
    document.getElementById('countOutput').textContent = '0 hasil';
    document.querySelectorAll('#digitCheckboxes input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    selectedDigits = [];
    setInfo('infoBBFS', 'Semua data telah direset!', 'info');
    showToast('Data berhasil dihapus!', 'delete');
}

function updateDigitCheckboxes(digitCount) {
    const checkboxContainer = document.getElementById('digitCheckboxes');
    checkboxContainer.innerHTML = '';
    selectedDigits = [];
    
    if (digitCount >= 2 && digitCount <= 6) {
        for (let i = 2; i <= digitCount; i++) {
            const checkboxItem = document.createElement('div');
            checkboxItem.className = 'checkbox-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `digit${i}`;
            checkbox.value = i;
            checkbox.checked = true;
            checkbox.addEventListener('change', handleDigitSelection);
            
            const label = document.createElement('label');
            label.htmlFor = `digit${i}`;
            label.textContent = `${i}D`;
            
            checkboxItem.appendChild(checkbox);
            checkboxItem.appendChild(label);
            checkboxContainer.appendChild(checkboxItem);
            selectedDigits.push(i);
        }
    }
}

function handleDigitSelection(event) {
    const digit = parseInt(event.target.value);
    if (event.target.checked) {
        if (!selectedDigits.includes(digit)) selectedDigits.push(digit);
    } else {
        selectedDigits = selectedDigits.filter(d => d !== digit);
    }
    selectedDigits.sort((a, b) => a - b);
}

// =============================================
// TAB 3: KOMBINASI FUNCTIONS
// =============================================
function generateKombinasi() {
    const input = document.getElementById('inputKelompok').value.trim();
    if (!input) {
        setInfo('infoKombinasi', 'Masukkan kelompok angka terlebih dahulu!', 'error');
        return;
    }
    
    // Generate berdasarkan jumlah kelompok dan pilihan user
    const selectedTypes = [];
    if (document.getElementById('kombinasi4D').checked) selectedTypes.push('4D');
    if (document.getElementById('kombinasi3D').checked) selectedTypes.push('3D');
    if (document.getElementById('kombinasi2D').checked) selectedTypes.push('2D');
    
    if (selectedTypes.length === 0) {
        setInfo('infoKombinasi', 'Pilih minimal satu jenis kombinasi!', 'error');
        return;
    }
    
    const groups = input.split(',').map(g => g.trim()).filter(g => g);
    const results = {
        '4D': [],
        '3D': [], 
        '2D': []
    };
    
    // Generate berdasarkan jumlah kelompok dan pilihan user
    if (groups.length >= 4 && selectedTypes.includes('4D')) {
        results['4D'] = generateCartesian(groups.slice(0, 4));
    }
    if (groups.length >= 3 && selectedTypes.includes('3D')) {
        results['3D'] = groups.length >= 4 ? generateCartesian(groups.slice(1, 4)) : generateCartesian(groups);
    }
    if (groups.length >= 2 && selectedTypes.includes('2D')) {
        results['2D'] = groups.length >= 4 ? generateCartesian(groups.slice(2, 4)) : 
                      groups.length >= 3 ? generateCartesian(groups.slice(1)) : generateCartesian(groups);
    }
    
    let output = '';
    let total = 0;
    
    if (results['4D'].length > 0) {
        output += `4D (${results['4D'].length} line):\n`;
        output += results['4D'].join('*') + '*\n\n';
        total += results['4D'].length;
    }
    
    if (results['3D'].length > 0) {
        output += `3D (${results['3D'].length} line):\n`;
        output += results['3D'].join('*') + '*\n\n';
        total += results['3D'].length;
    }
    
    if (results['2D'].length > 0) {
        output += `2D (${results['2D'].length} line):\n`;
        output += results['2D'].join('*') + '*\n';
        total += results['2D'].length;
    }
    
    document.getElementById('outputKombinasi').textContent = output || 'Tidak ada kombinasi yang dihasilkan';
    document.getElementById('totalKombinasi').textContent = `${total} kombinasi`;
    setInfo('infoKombinasi', `Berhasil generate ${total} kombinasi!`, 'success');
    showToast('Tugas selesai!', 'done');
}

function generateCartesian(arrays) {
    if (arrays.length === 0) return [];
    
    let results = arrays[0].split('');
    
    for (let i = 1; i < arrays.length; i++) {
        const temp = [];
        const currentArray = arrays[i].split('');
        
        for (let j = 0; j < results.length; j++) {
            for (let k = 0; k < currentArray.length; k++) {
                temp.push(results[j] + currentArray[k]);
            }
        }
        results = temp;
    }
    
    return results;
}

function copyKombinasi() {
    copyToClipboard($('outputKombinasi').textContent);
    setInfo('infoKombinasi', 'Hasil kombinasi berhasil disalin!', 'success');
    showToast('Output berhasil disalin!', 'copy');
}

function clearKombinasi() {

    document.getElementById('inputKelompok').value = '';
    document.getElementById('outputKombinasi').textContent = '// Hasil kombinasi akan muncul di sini...';
    document.getElementById('totalKombinasi').textContent = '0 kombinasi';
    document.querySelectorAll('#kombinasiCheckboxes input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = true;
    });
    setInfo('infoKombinasi', 'üí° Masukkan kelompok angka dipisahkan koma', 'default');
    showToast('Data berhasil dihapus!', 'delete');
}

// =============================================
// TAB 4: REKAP CT & KUMAT FUNCTIONS
// =============================================
let currentMode = null;

function updateMode() {
    const ctChecked = document.getElementById('ModeCT').checked;
    const kumatChecked = document.getElementById('ModeKumat').checked;
    
    // Update placeholder berdasarkan mode yang dipilih
    const textarea = document.getElementById('inputCTKumat');
    
    if (ctChecked) {
        currentMode = 'ct';
        textarea.placeholder = "Masukkan CT (2-7 digit):\n04\n46\n94\n91\n61";
        setInfo('infoCTKumat', 'üí° Mode CT aktif - Masukkan data CT', 'default');
    } else if (kumatChecked) {
        currentMode = 'kumat';
        textarea.placeholder = "Masukkan data KUMAT:\n12356789\n01235789\n01235678";
        setInfo('infoCTKumat', 'üí° Mode KUMAT aktif - Masukkan data KUMAT', 'default');
    } else {
        currentMode = null;
        textarea.placeholder = "Pilih mode terlebih dahulu, lalu masukkan data...";
        setInfo('infoCTKumat', '‚ùå Pilih salah satu mode!', 'error');
    }
}

function extractNumbers(raw, minLen, maxLen) {
    const matches = raw.match(/\d+/g) || [];
    const out = [];
    for (let i = 0; i < matches.length; i++) {
        const s = String(matches[i]).trim();
        if (!s) continue;
        if (s.length < minLen || s.length > maxLen) continue;
        out.push(s);
    }
    return out;
}

function renderCTKumatTable(result) {
    const rows = [
        { rank: 1, label: 'Rangking 1', arr: result.lolosKumat || [] },
        { rank: 2, label: 'Rangking 2', arr: result.kena1x || [] },
        { rank: 3, label: 'Rangking 3', arr: result.kena2x || [] },
        { rank: 4, label: 'Rangking 4', arr: result.kena3x || [] },
        { rank: 5, label: 'Rangking 5', arr: result.kena4x || [] },
        { rank: 6, label: 'Rangking 6', arr: result.kena5x || [] },
        { rank: 7, label: 'Rangking 7', arr: result.kena6x || [] },
    ];

    let html = '<table class="rekap-table"><colgroup><col style="width:20%"><col style="width:80%"></colgroup>';
    html += '<tbody>';

    // siapkan teks untuk copy juga
    let copyText = '';

    for (let i = 0; i < rows.length; i++) {
        const r = rows[i];
        const nums = r.arr;
        const numsText = (nums && nums.length) ? (nums.join('*') + '*') : '';
        const countText = (nums && nums.length) ? (nums.length + ' Line') : '0 Line';

        html += '<tr>';
        html += `<td class="rekap-label rank-${r.rank}">${r.label}</td>`;
        html += '<td class="rekap-values">';
        if (numsText) {
            html += `<span class="nums">${escapeHtml(numsText)}</span>`;
        } else {
            html += '';
        }
        html += `<div class="rekap-count">${escapeHtml(countText)}</div>`;
        html += '</td></tr>';

        copyText += `${r.label}\n`;
        copyText += (numsText ? numsText : '-') + '\n';
        copyText += countText + '\n\n';
    }

    html += '</tbody></table>';
    window._ctkCopyText = copyText.trim();
    return html;
}

function escapeHtml(str) {
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
}

function prosesRekapCTKumat() {
    // Validasi: pastikan mode sudah dipilih
    if (currentMode === null) {
        setInfo('infoCTKumat', '‚ùå Pilih mode terlebih dahulu!', 'error');
        return;
    }

    const textarea = document.getElementById('inputCTKumat');
    const raw = (textarea.value || '').trim();
    if (!raw) {
        setInfo('infoCTKumat', 'Masukkan data terlebih dahulu!', 'error');
        return;
    }

    // Ambil angka saja (apapun pemisahnya)
    const minLen = (currentMode === 'ct') ? 2 : 2;
    const maxLen = (currentMode === 'ct') ? 7 : 9;

    const lines = extractNumbers(raw, minLen, maxLen);

    if (lines.length === 0) {
        setInfo('infoCTKumat', (currentMode === 'ct')
            ? 'Tidak ditemukan angka 2-7 digit!'
            : 'Tidak ditemukan angka 2-9 digit!', 'error');
        return;
    }

    // Normalisasi tampilan input jadi per-baris
    textarea.value = lines.join('\n');

    let kumatSets;

    if (currentMode === 'ct') {
        // Validasi CT mode (double safety)
        for (let i = 0; i < lines.length; i++) {
            if (!/^\d{2,7}$/.test(lines[i])) {
                setInfo('infoCTKumat', 'Semua CT harus 2-7 digit angka!', 'error');
                return;
            }
        }
        kumatSets = processCTMode(lines);
    } else if (currentMode === 'kumat') {
        // Validasi KUMAT mode (double safety)
        for (let i = 0; i < lines.length; i++) {
            if (!/^\d{2,9}$/.test(lines[i])) {
                setInfo('infoCTKumat', 'KUMAT harus terdiri dari digit 0-9 (min 2 digit)!', 'error');
                return;
            }
        }
        kumatSets = processKumatMode(lines);
    }

    const result = hitungRanking(kumatSets);
    tampilkanHasilCTKumat(result);
    setInfo('infoCTKumat', 'Rekap berhasil diproses!', 'success');
    showToast('Tugas selesai!', 'done');
}

function processCTMode(controls) {
    const kumatSets = [];
    
    for (let control of controls) {
        const digits = new Set(control.split(''));
        const kumatDigits = getKumatDigits(digits);
        const permutations = generatePermutations(kumatDigits);
        kumatSets.push(permutations);
    }
    
    return kumatSets;
}

function processKumatMode(kumats) {
    const kumatSets = [];
    
    for (let kumat of kumats) {
        const kumatDigits = new Set(kumat.split(''));
        const permutations = generatePermutations(kumatDigits);
        kumatSets.push(permutations);
    }
    
    return kumatSets;
}

function hitungRanking(kumatSets) {
    const allNumbers = generateAllNumbers();
    const results = {
        lolosKumat: [],
        kena1x: [],
        kena2x: [],
        kena3x: [],
        kena4x: [],
        kena5x: [],
        kena6x: [],
    };
    
    for (let number of allNumbers) {
        let kenaCount = 0;
        
        for (let permutations of kumatSets) {
            if (permutations.has(number)) {
                kenaCount++;
            }
        }
        
        if (kenaCount === 0 && !isTwin(number)) {
            results.lolosKumat.push(number);
        } else if (kenaCount === 1) {
            results.kena1x.push(number);
        } else if (kenaCount === 2) {
            results.kena2x.push(number);
        } else if (kenaCount === 3) {
            results.kena3x.push(number);
        } else if (kenaCount === 4) {
            results.kena4x.push(number);
        } else if (kenaCount === 5) {
            results.kena5x.push(number);
        } else if (kenaCount === 6) {
            results.kena6x.push(number);
        }
    }
    
    return results;
}

function getKumatDigits(controlDigits) {
    const allDigits = new Set('0123456789');
    const kumatDigits = new Set();
    
    for (let digit of allDigits) {
        if (!controlDigits.has(digit)) {
            kumatDigits.add(digit);
        }
    }
    
    return kumatDigits;
}

function generatePermutations(digits) {
    const permutations = new Set();
    const digitArray = Array.from(digits);
    
    for (let i = 0; i < digitArray.length; i++) {
        for (let j = 0; j < digitArray.length; j++) {
            if (i !== j) {
                permutations.add(digitArray[i] + digitArray[j]);
            }
        }
    }
    
    return permutations;
}

function generateAllNumbers() {
    const numbers = [];
    for (let i = 0; i <= 99; i++) {
        numbers.push(i.toString().padStart(2, '0'));
    }
    return numbers;
}

function isTwin(number) {
    return number[0] === number[1];
}

function tampilkanHasilCTKumat(result) {
    const wrap = document.getElementById('ctKumatOutput');
    if (!wrap) return;

    // render tabel
    wrap.innerHTML = renderCTKumatTable(result);
}

function copyOutputCTKumat() {
    const text = (window._ctkCopyText && String(window._ctkCopyText).trim())
        ? window._ctkCopyText
        : 'Belum ada hasil untuk disalin.';
    copyToClipboard(text);
    showToast('Output berhasil disalin!', 'copy');
}

function cleanAllCTKumat() {
    const textarea = document.getElementById('inputCTKumat');
    if (textarea) textarea.value = '';

    // Reset radio buttons
    const ct = document.getElementById('ModeCT');
    const km = document.getElementById('ModeKumat');
    if (ct) ct.checked = false;
    if (km) km.checked = false;
    currentMode = null;

    const wrap = document.getElementById('ctKumatOutput');
    if (wrap) {
        wrap.innerHTML = '<div class="ctk-empty" id="ctkEmpty">// Pilih mode dan masukkan data...</div>';
    }

    window._ctkCopyText = '';
    setInfo('infoCTKumat', 'üí° Pilih mode terlebih dahulu, lalu masukkan data', 'default');
    showToast('Data berhasil dihapus!', 'delete');
}

// =============================================
// NOTIFIKASI (standar)
// =============================================
function setInfo(targetId, message, type){
    const el = $(targetId);
    if (!el) return;
    // Hindari update DOM kalau pesannya sama (lebih ringan)
    if (el._lastMsg === message && el._lastType === type) return;
    el._lastMsg = message;
    el._lastType = type;

    el.textContent = message;
    el.className = 'info';
    if (type === 'error') el.classList.add('error');
    else if (type === 'success') el.classList.add('success');
    else if (type === 'warning') el.classList.add('warning');
}

// Toast mengambang (khusus SALIN / HAPUS / SELESAI)
function getOrCreateToastDiv(){
    let el = $('globalToast');
    if (!el){
        el = document.createElement('div');
        el.id = 'globalToast';
        el.className = 'toast hide';
        document.body.appendChild(el);
        _dom['globalToast'] = el;
    }
    return el;
}

function showToast(message, kind){
    const toast = getOrCreateToastDiv();
    toast.textContent = message;

    // Reset class
    toast.className = 'toast';

    // Warna sesuai permintaan:
    // - hapus: merah
    // - salin: hijau
    // - tugas selesai: biru
    if (kind === 'copy') toast.classList.add('toast-copy');
    else if (kind === 'delete') toast.classList.add('toast-delete');
    else if (kind === 'done') toast.classList.add('toast-done');
    else if (kind === 'error') toast.classList.add('toast-delete');
    else if (kind === 'warning') toast.classList.add('toast-done');

    toast.classList.remove('hide');

    const duration = (kind === 'error') ? 4200 : (kind === 'warning') ? 3800 : 2400;
    if (toast._hideTimer) clearTimeout(toast._hideTimer);
    toast._hideTimer = setTimeout(() => toast.classList.add('hide'), duration);
}


// =============================================
// UTILITY FUNCTIONS
// =============================================
function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
            console.log('Text copied to clipboard');
        }).catch(err => {
            useFallbackCopy(text);
        });
    } else {
        useFallbackCopy(text);
    }
}

function useFallbackCopy(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
        document.execCommand('copy');
        console.log('Text copied to clipboard (fallback)');
    } catch (err) {
        console.error('Failed to copy text: ', err);
    }
    document.body.removeChild(textArea);
}

// =============================================
// INITIALIZATION
// =============================================
document.addEventListener('DOMContentLoaded', function() {
    // Load theme
    loadTheme();
    
    // Initialize BBFS digit checkboxes
    updateDigitCheckboxes(0);
    
    // Add event listeners for radio buttons
    document.getElementById('ModeCT').addEventListener('change', updateMode);
    document.getElementById('ModeKumat').addEventListener('change', updateMode);
    
    // Add event listener for BBFS input
    document.getElementById('inputAngka').addEventListener('input', function() {
        const digitCount = this.value.length;
        updateDigitCheckboxes(digitCount);
    });
});
</script>
</body>
</html>
